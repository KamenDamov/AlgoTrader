{"ast":null,"code":"// Ported from https://github.com/mafintosh/end-of-stream with\n// permission from the author, Mathias Buus (@mafintosh).\n'use strict';\n\nconst ERR_STREAM_PREMATURE_CLOSE = require('../../../errors').codes.ERR_STREAM_PREMATURE_CLOSE;\n\nfunction once(callback) {\n  let called = false;\n  return function () {\n    if (called) return;\n    called = true;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    callback.apply(this, args);\n  };\n}\n\nfunction noop() {}\n\nfunction isRequest(stream) {\n  return stream.setHeader && typeof stream.abort === 'function';\n}\n\nfunction eos(stream, opts, callback) {\n  if (typeof opts === 'function') return eos(stream, null, opts);\n  if (!opts) opts = {};\n  callback = once(callback || noop);\n  let readable = opts.readable || opts.readable !== false && stream.readable;\n  let writable = opts.writable || opts.writable !== false && stream.writable;\n\n  const onlegacyfinish = () => {\n    if (!stream.writable) onfinish();\n  };\n\n  var writableEnded = stream._writableState && stream._writableState.finished;\n\n  const onfinish = () => {\n    writable = false;\n    writableEnded = true;\n    if (!readable) callback.call(stream);\n  };\n\n  var readableEnded = stream._readableState && stream._readableState.endEmitted;\n\n  const onend = () => {\n    readable = false;\n    readableEnded = true;\n    if (!writable) callback.call(stream);\n  };\n\n  const onerror = err => {\n    callback.call(stream, err);\n  };\n\n  const onclose = () => {\n    let err;\n\n    if (readable && !readableEnded) {\n      if (!stream._readableState || !stream._readableState.ended) err = new ERR_STREAM_PREMATURE_CLOSE();\n      return callback.call(stream, err);\n    }\n\n    if (writable && !writableEnded) {\n      if (!stream._writableState || !stream._writableState.ended) err = new ERR_STREAM_PREMATURE_CLOSE();\n      return callback.call(stream, err);\n    }\n  };\n\n  const onrequest = () => {\n    stream.req.on('finish', onfinish);\n  };\n\n  if (isRequest(stream)) {\n    stream.on('complete', onfinish);\n    stream.on('abort', onclose);\n    if (stream.req) onrequest();else stream.on('request', onrequest);\n  } else if (writable && !stream._writableState) {\n    // legacy streams\n    stream.on('end', onlegacyfinish);\n    stream.on('close', onlegacyfinish);\n  }\n\n  stream.on('end', onend);\n  stream.on('finish', onfinish);\n  if (opts.error !== false) stream.on('error', onerror);\n  stream.on('close', onclose);\n  return function () {\n    stream.removeListener('complete', onfinish);\n    stream.removeListener('abort', onclose);\n    stream.removeListener('request', onrequest);\n    if (stream.req) stream.req.removeListener('finish', onfinish);\n    stream.removeListener('end', onlegacyfinish);\n    stream.removeListener('close', onlegacyfinish);\n    stream.removeListener('finish', onfinish);\n    stream.removeListener('end', onend);\n    stream.removeListener('error', onerror);\n    stream.removeListener('close', onclose);\n  };\n}\n\nmodule.exports = eos;","map":{"version":3,"names":["ERR_STREAM_PREMATURE_CLOSE","require","codes","once","callback","called","_len","arguments","length","args","Array","_key","apply","noop","isRequest","stream","setHeader","abort","eos","opts","readable","writable","onlegacyfinish","onfinish","writableEnded","_writableState","finished","call","readableEnded","_readableState","endEmitted","onend","onerror","err","onclose","ended","onrequest","req","on","error","removeListener","module","exports"],"sources":["C:/Users/Kamen/ML/AlgoTrader/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"],"sourcesContent":["// Ported from https://github.com/mafintosh/end-of-stream with\n// permission from the author, Mathias Buus (@mafintosh).\n\n'use strict';\n\nconst ERR_STREAM_PREMATURE_CLOSE = require('../../../errors').codes.ERR_STREAM_PREMATURE_CLOSE;\nfunction once(callback) {\n  let called = false;\n  return function () {\n    if (called) return;\n    called = true;\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    callback.apply(this, args);\n  };\n}\nfunction noop() {}\nfunction isRequest(stream) {\n  return stream.setHeader && typeof stream.abort === 'function';\n}\nfunction eos(stream, opts, callback) {\n  if (typeof opts === 'function') return eos(stream, null, opts);\n  if (!opts) opts = {};\n  callback = once(callback || noop);\n  let readable = opts.readable || opts.readable !== false && stream.readable;\n  let writable = opts.writable || opts.writable !== false && stream.writable;\n  const onlegacyfinish = () => {\n    if (!stream.writable) onfinish();\n  };\n  var writableEnded = stream._writableState && stream._writableState.finished;\n  const onfinish = () => {\n    writable = false;\n    writableEnded = true;\n    if (!readable) callback.call(stream);\n  };\n  var readableEnded = stream._readableState && stream._readableState.endEmitted;\n  const onend = () => {\n    readable = false;\n    readableEnded = true;\n    if (!writable) callback.call(stream);\n  };\n  const onerror = err => {\n    callback.call(stream, err);\n  };\n  const onclose = () => {\n    let err;\n    if (readable && !readableEnded) {\n      if (!stream._readableState || !stream._readableState.ended) err = new ERR_STREAM_PREMATURE_CLOSE();\n      return callback.call(stream, err);\n    }\n    if (writable && !writableEnded) {\n      if (!stream._writableState || !stream._writableState.ended) err = new ERR_STREAM_PREMATURE_CLOSE();\n      return callback.call(stream, err);\n    }\n  };\n  const onrequest = () => {\n    stream.req.on('finish', onfinish);\n  };\n  if (isRequest(stream)) {\n    stream.on('complete', onfinish);\n    stream.on('abort', onclose);\n    if (stream.req) onrequest();else stream.on('request', onrequest);\n  } else if (writable && !stream._writableState) {\n    // legacy streams\n    stream.on('end', onlegacyfinish);\n    stream.on('close', onlegacyfinish);\n  }\n  stream.on('end', onend);\n  stream.on('finish', onfinish);\n  if (opts.error !== false) stream.on('error', onerror);\n  stream.on('close', onclose);\n  return function () {\n    stream.removeListener('complete', onfinish);\n    stream.removeListener('abort', onclose);\n    stream.removeListener('request', onrequest);\n    if (stream.req) stream.req.removeListener('finish', onfinish);\n    stream.removeListener('end', onlegacyfinish);\n    stream.removeListener('close', onlegacyfinish);\n    stream.removeListener('finish', onfinish);\n    stream.removeListener('end', onend);\n    stream.removeListener('error', onerror);\n    stream.removeListener('close', onclose);\n  };\n}\nmodule.exports = eos;"],"mappings":"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"},"metadata":{},"sourceType":"script"}