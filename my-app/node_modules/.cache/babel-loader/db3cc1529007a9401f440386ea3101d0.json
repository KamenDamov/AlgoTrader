{"ast":null,"code":"// Copyright 2012 Iris Couch, all rights reserved.\n//\n// Encode DNS messages\nvar util = require('util');\n\nvar constants = require('./constants');\n\nmodule.exports = {\n  'State': State\n};\nvar SECTIONS = ['question', 'answer', 'authority', 'additional'];\n\nfunction State() {\n  var self = this;\n  self.header = new Buffer(12);\n  self.position = 0;\n  self.question = [];\n  self.answer = [];\n  self.authority = [];\n  self.additional = [];\n  self.domains = {}; // The compression lookup table\n}\n\nState.prototype.toBinary = function () {\n  var self = this;\n  var bufs = [self.header];\n  self.question.forEach(function (buf) {\n    bufs.push(buf);\n  });\n  self.answer.forEach(function (buf) {\n    bufs.push(buf);\n  });\n  self.authority.forEach(function (buf) {\n    bufs.push(buf);\n  });\n  self.additional.forEach(function (buf) {\n    bufs.push(buf);\n  });\n  return Buffer.concat(bufs);\n};\n\nState.prototype.message = function (msg) {\n  var self = this; // ID\n\n  self.header.writeUInt16BE(msg.id, 0); // QR, opcode, AA, TC, RD\n\n  var byte = 0;\n  byte |= msg.type == 'response' ? 0x80 : 0x00;\n  byte |= msg.authoritative ? 0x04 : 0x00;\n  byte |= msg.truncated ? 0x02 : 0x00;\n  byte |= msg.recursion_desired ? 0x01 : 0x00;\n  var opcode_names = ['query', 'iquery', 'status', null, 'notify', 'update'],\n      opcode = opcode_names.indexOf(msg.opcode);\n  if (opcode == -1 || typeof msg.opcode != 'string') throw new Error('Unknown opcode: ' + msg.opcode);else byte |= opcode << 3;\n  self.header.writeUInt8(byte, 2); // RA, Z, AD, CD, Rcode\n\n  byte = 0;\n  byte |= msg.recursion_available ? 0x80 : 0x00;\n  byte |= msg.authenticated ? 0x20 : 0x00;\n  byte |= msg.checking_disabled ? 0x10 : 0x00;\n  byte |= msg.responseCode & 0x0f;\n  self.header.writeUInt8(byte, 3);\n  self.position = 12; // the beginning of the sections\n\n  SECTIONS.forEach(function (section) {\n    var records = msg[section] || [];\n    records.forEach(function (rec) {\n      self.record(section, rec);\n    });\n  }); // Write the section counts.\n\n  self.header.writeUInt16BE(self.question.length, 4);\n  self.header.writeUInt16BE(self.answer.length, 6);\n  self.header.writeUInt16BE(self.authority.length, 8);\n  self.header.writeUInt16BE(self.additional.length, 10);\n};\n\nState.prototype.record = function (section_name, record) {\n  var self = this;\n  var body = [],\n      buf; // Write the record name.\n\n  buf = self.encode(record.name);\n  body.push(buf);\n  self.position += buf.length;\n  var type = constants.type_to_number(record.type),\n      clas = constants.class_to_number(record.class); // Write the type.\n\n  buf = new Buffer(2);\n  buf.writeUInt16BE(type, 0);\n  body.push(buf);\n  self.position += 2; // Write the class.\n\n  buf = new Buffer(2);\n  buf.writeUInt16BE(clas, 0);\n  body.push(buf);\n  self.position += 2;\n\n  if (section_name != 'question') {\n    // Write the TTL.\n    buf = new Buffer(4);\n    buf.writeUInt32BE(record.ttl || 0, 0);\n    body.push(buf);\n    self.position += 4; // Write the rdata. Update the position now (the rdata length value) in case self.encode() runs.\n\n    var match, rdata;\n\n    switch (record.class + ' ' + record.type) {\n      case 'IN A':\n        rdata = record.data || '';\n        match = rdata.match(/^(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)$/);\n        if (!match) throw new Error('Bad ' + record.type + ' record data: ' + JSON.stringify(record));\n        rdata = [+match[1], +match[2], +match[3], +match[4]];\n        break;\n\n      case 'IN AAAA':\n        // [hbouvier] More robust parsing of ipV6 address\n        rdata = ipv6_to_array(record.data || '::');\n        if (rdata.length !== 8) throw new Error('Bad ' + record.type + ' record data: ' + JSON.stringify(record));\n        rdata = rdata.map(pair_to_buf);\n        break;\n\n      case 'IN MX':\n        var host = record.data[1];\n        rdata = [buf16(record.data[0]), self.encode(host, 2 + 2) // Adjust for the rdata length + preference values.\n        ];\n        break;\n\n      case 'IN SOA':\n        var mname = self.encode(record.data.mname, 2) // Adust for rdata length\n        ,\n            rname = self.encode(record.data.rname, 2 + mname.length);\n        rdata = [mname, rname, buf32(record.data.serial), buf32(record.data.refresh), buf32(record.data.retry), buf32(record.data.expire), buf32(record.data.ttl)];\n        break;\n\n      case 'IN NS':\n      case 'IN PTR':\n      case 'IN CNAME':\n        rdata = self.encode(record.data, 2); // Adjust for the rdata length\n\n        break;\n\n      case 'IN TXT':\n        rdata = record.data.map(function (part) {\n          part = new Buffer(part);\n          return [part.length, part];\n        });\n        break;\n\n      case 'IN SRV':\n        rdata = [buf16(record.data.priority), buf16(record.data.weight), buf16(record.data.port), self.encode(record.data.target, 2 + 6, 'nocompress') // Offset for rdata length + priority, weight, and port.\n        ];\n        break;\n\n      case 'IN DS':\n        rdata = [buf16(record.data.key_tag), new Buffer([record.data.algorithm]), new Buffer([record.data.digest_type]), new Buffer(record.data.digest)];\n        break;\n\n      case 'NONE A':\n        // I think this is no data, from RFC 2136 S. 2.4.3.\n        rdata = [];\n        break;\n\n      default:\n        throw new Error('Unsupported record type: ' + JSON.stringify(record));\n    } // Write the rdata length. (The position was already updated.)\n\n\n    rdata = flat(rdata);\n    buf = new Buffer(2);\n    buf.writeUInt16BE(rdata.length, 0);\n    body.push(buf);\n    self.position += 2; // Write the rdata.\n\n    self.position += rdata.length;\n    if (rdata.length > 0) body.push(new Buffer(rdata));\n  }\n\n  self[section_name].push(Buffer.concat(body));\n};\n\nState.prototype.encode = function (full_domain, position_offset, option) {\n  var self = this; // [hbouvier] Added default value\n\n  var domain = full_domain || '';\n  domain = domain.replace(/\\.$/, ''); // Strip the trailing dot.\n\n  position = self.position + (position_offset || 0);\n  var body = [],\n      bytes;\n  var i = 0;\n  var max_iterations = 40; // Enough for 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa\n\n  while (++i < max_iterations) {\n    if (domain == '') {\n      // Encode the root domain and be done.\n      body.push(new Buffer([0]));\n      return Buffer.concat(body);\n    } else if (self.domains[domain] && option !== 'nocompress') {\n      // Encode a pointer and be done.\n      body.push(new Buffer([0xc0, self.domains[domain]]));\n      return Buffer.concat(body);\n    } else {\n      // Encode the next part of the domain, saving its position in the lookup table for later.\n      self.domains[domain] = position;\n      var parts = domain.split(/\\./),\n          car = parts[0];\n      domain = parts.slice(1).join('.'); // Write the first part of the domain, with a length prefix.\n      //var part = parts[0]\n\n      var buf = new Buffer(car.length + 1);\n      buf.write(car, 1, car.length, 'ascii');\n      buf.writeUInt8(car.length, 0);\n      body.push(buf);\n      position += buf.length; //bytes.unshift(bytes.length)\n    }\n  }\n\n  throw new Error('Too many iterations encoding domain: ' + full_domain);\n}; //\n// Utilities\n//\n\n\nfunction buf32(value) {\n  var buf = new Buffer(4);\n  buf.writeUInt32BE(value, 0);\n  return buf;\n}\n\nfunction buf16(value) {\n  var buf = new Buffer(2);\n  buf.writeUInt16BE(value, 0);\n  return buf;\n}\n\nfunction flat(data) {\n  return Buffer.isBuffer(data) ? Array.prototype.slice.call(data) : Array.isArray(data) ? data.reduce(flatten, []) : [data];\n}\n\nfunction flatten(state, element) {\n  return Buffer.isBuffer(element) || Array.isArray(element) ? state.concat(flat(element)) : state.concat([element]);\n}\n\nfunction pair_to_buf(pair) {\n  // [hbouvier]  It is possible that the \"pair\" has less than 4 digits, lets\n  //             make sure that it has.\n  var pairLength = pair.length;\n  if (pairLength < 4) pair = \"0000\".substring(pairLength) + pair; // Convert a string of two hex bytes, e.g. \"89ab\" to a buffer.\n\n  if (!pair.match(/^[0-9a-fA-F]{4}$/)) throw new Error('Bad ' + record.type + ' record data: ' + JSON.stringify(record));\n  return new Buffer(pair, 'hex');\n} // [hbouvier] More robust parsing of ipV6 address\n\n\nfunction ipv6_to_array(string) {\n  var fullAddress = ['0', '0', '0', '0', '0', '0', '0', '0']; // Remove the contiguous empty strings generated by '::' and keep ony one.\n\n  var numbers = string.split(/:/).reduce(function (previous, current) {\n    if (previous instanceof Array === false) previous = [previous];\n\n    if (!(current === '' && previous[previous.length - 1] === '')) {\n      previous.push(current);\n    }\n\n    return previous;\n  }); // Replace the single empty string, by the number of '0' that\n  // were \"missing\" (e.g. shortened address)\n\n  var merged = [].concat.apply([], numbers.map(function (num) {\n    return num === '' ? fullAddress.slice(numbers.length - 1) : num;\n  }));\n  return merged;\n}","map":{"version":3,"names":["util","require","constants","module","exports","State","SECTIONS","self","header","Buffer","position","question","answer","authority","additional","domains","prototype","toBinary","bufs","forEach","buf","push","concat","message","msg","writeUInt16BE","id","byte","type","authoritative","truncated","recursion_desired","opcode_names","opcode","indexOf","Error","writeUInt8","recursion_available","authenticated","checking_disabled","responseCode","section","records","rec","record","length","section_name","body","encode","name","type_to_number","clas","class_to_number","class","writeUInt32BE","ttl","match","rdata","data","JSON","stringify","ipv6_to_array","map","pair_to_buf","host","buf16","mname","rname","buf32","serial","refresh","retry","expire","part","priority","weight","port","target","key_tag","algorithm","digest_type","digest","flat","full_domain","position_offset","option","domain","replace","bytes","i","max_iterations","parts","split","car","slice","join","write","value","isBuffer","Array","call","isArray","reduce","flatten","state","element","pair","pairLength","substring","string","fullAddress","numbers","previous","current","merged","apply","num"],"sources":["C:/Users/Kamen/ML/AlgoTrader/node_modules/hbo-dnsd/encode.js"],"sourcesContent":["// Copyright 2012 Iris Couch, all rights reserved.\r\n//\r\n// Encode DNS messages\r\n\r\nvar util = require('util')\r\n\r\nvar constants = require('./constants')\r\n\r\nmodule.exports = { 'State': State\r\n                 }\r\n\r\nvar SECTIONS = ['question', 'answer', 'authority', 'additional']\r\n\r\nfunction State () {\r\n  var self = this\r\n\r\n  self.header = new Buffer(12)\r\n  self.position = 0\r\n\r\n  self.question   = []\r\n  self.answer     = []\r\n  self.authority  = []\r\n  self.additional = []\r\n\r\n  self.domains = {} // The compression lookup table\r\n}\r\n\r\nState.prototype.toBinary = function() {\r\n  var self = this\r\n\r\n  var bufs = [self.header]\r\n  self.question  .forEach(function(buf) { bufs.push(buf) })\r\n  self.answer    .forEach(function(buf) { bufs.push(buf) })\r\n  self.authority .forEach(function(buf) { bufs.push(buf) })\r\n  self.additional.forEach(function(buf) { bufs.push(buf) })\r\n\r\n  return Buffer.concat(bufs)\r\n}\r\n\r\nState.prototype.message = function(msg) {\r\n  var self = this\r\n\r\n  // ID\r\n  self.header.writeUInt16BE(msg.id, 0)\r\n\r\n  // QR, opcode, AA, TC, RD\r\n  var byte = 0\r\n  byte |= msg.type == 'response' ? 0x80 : 0x00\r\n  byte |= msg.authoritative      ? 0x04 : 0x00\r\n  byte |= msg.truncated          ? 0x02 : 0x00\r\n  byte |= msg.recursion_desired  ? 0x01 : 0x00\r\n\r\n  var opcode_names = ['query', 'iquery', 'status', null, 'notify', 'update']\r\n    , opcode = opcode_names.indexOf(msg.opcode)\r\n\r\n  if(opcode == -1 || typeof msg.opcode != 'string')\r\n    throw new Error('Unknown opcode: ' + msg.opcode)\r\n  else\r\n    byte |= (opcode << 3)\r\n\r\n  self.header.writeUInt8(byte, 2)\r\n\r\n  // RA, Z, AD, CD, Rcode\r\n  byte = 0\r\n  byte |= msg.recursion_available ? 0x80 : 0x00\r\n  byte |= msg.authenticated       ? 0x20 : 0x00\r\n  byte |= msg.checking_disabled   ? 0x10 : 0x00\r\n  byte |= (msg.responseCode & 0x0f)\r\n\r\n  self.header.writeUInt8(byte, 3)\r\n\r\n  self.position = 12 // the beginning of the sections\r\n  SECTIONS.forEach(function(section) {\r\n    var records = msg[section] || []\r\n    records.forEach(function(rec) {\r\n      self.record(section, rec)\r\n    })\r\n  })\r\n\r\n  // Write the section counts.\r\n  self.header.writeUInt16BE(self.question.length    , 4)\r\n  self.header.writeUInt16BE(self.answer.length      , 6)\r\n  self.header.writeUInt16BE(self.authority.length   , 8)\r\n  self.header.writeUInt16BE(self.additional.length  , 10)\r\n}\r\n\r\nState.prototype.record = function(section_name, record) {\r\n  var self = this\r\n\r\n  var body = []\r\n    , buf\r\n\r\n  // Write the record name.\r\n  buf = self.encode(record.name)\r\n  body.push(buf)\r\n  self.position += buf.length\r\n\r\n  var type = constants.type_to_number(record.type)\r\n    , clas = constants.class_to_number(record.class)\r\n\r\n  // Write the type.\r\n  buf = new Buffer(2)\r\n  buf.writeUInt16BE(type, 0)\r\n  body.push(buf)\r\n  self.position += 2\r\n\r\n  // Write the class.\r\n  buf = new Buffer(2)\r\n  buf.writeUInt16BE(clas, 0)\r\n  body.push(buf)\r\n  self.position += 2\r\n\r\n  if(section_name != 'question') {\r\n    // Write the TTL.\r\n    buf = new Buffer(4)\r\n    buf.writeUInt32BE(record.ttl || 0, 0)\r\n    body.push(buf)\r\n    self.position += 4\r\n\r\n    // Write the rdata. Update the position now (the rdata length value) in case self.encode() runs.\r\n    var match, rdata\r\n    switch (record.class + ' ' + record.type) {\r\n      case 'IN A':\r\n        rdata = record.data || ''\r\n        match = rdata.match(/^(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)$/)\r\n        if(!match)\r\n          throw new Error('Bad '+record.type+' record data: ' + JSON.stringify(record))\r\n        rdata = [ +match[1], +match[2], +match[3], +match[4] ]\r\n        break\r\n      case 'IN AAAA':\r\n        // [hbouvier] More robust parsing of ipV6 address\r\n        rdata = ipv6_to_array(record.data || '::')\r\n        if(rdata.length !== 8)\r\n          throw new Error('Bad '+record.type+' record data: ' + JSON.stringify(record))\r\n        rdata = rdata.map(pair_to_buf)\r\n        break\r\n      case 'IN MX':\r\n        var host = record.data[1]\r\n        rdata = [ buf16(record.data[0])\r\n                , self.encode(host, 2 + 2) // Adjust for the rdata length + preference values.\r\n                ]\r\n        break\r\n      case 'IN SOA':\r\n        var mname   = self.encode(record.data.mname, 2) // Adust for rdata length\r\n          , rname   = self.encode(record.data.rname, 2 + mname.length)\r\n        rdata = [ mname\r\n                , rname\r\n                , buf32(record.data.serial)\r\n                , buf32(record.data.refresh)\r\n                , buf32(record.data.retry)\r\n                , buf32(record.data.expire)\r\n                , buf32(record.data.ttl)\r\n                ]\r\n        break\r\n      case 'IN NS':\r\n      case 'IN PTR':\r\n      case 'IN CNAME':\r\n        rdata = self.encode(record.data, 2) // Adjust for the rdata length\r\n        break\r\n      case 'IN TXT':\r\n        rdata = record.data.map(function(part) {\r\n          part = new Buffer(part)\r\n          return [part.length, part]\r\n        })\r\n        break\r\n      case 'IN SRV':\r\n        rdata = [ buf16(record.data.priority)\r\n                , buf16(record.data.weight)\r\n                , buf16(record.data.port)\r\n                , self.encode(record.data.target, 2 + 6, 'nocompress') // Offset for rdata length + priority, weight, and port.\r\n                ]\r\n        break\r\n      case 'IN DS':\r\n        rdata = [ buf16(record.data.key_tag)\r\n                , new Buffer([record.data.algorithm])\r\n                , new Buffer([record.data.digest_type])\r\n                , new Buffer(record.data.digest)\r\n                ]\r\n        break\r\n      case 'NONE A':\r\n        // I think this is no data, from RFC 2136 S. 2.4.3.\r\n        rdata = []\r\n        break\r\n      default:\r\n        throw new Error('Unsupported record type: ' + JSON.stringify(record))\r\n    }\r\n\r\n    // Write the rdata length. (The position was already updated.)\r\n    rdata = flat(rdata)\r\n    buf = new Buffer(2)\r\n    buf.writeUInt16BE(rdata.length, 0)\r\n    body.push(buf)\r\n    self.position += 2\r\n\r\n    // Write the rdata.\r\n    self.position += rdata.length\r\n    if(rdata.length > 0)\r\n      body.push(new Buffer(rdata))\r\n  }\r\n\r\n  self[section_name].push(Buffer.concat(body))\r\n}\r\n\r\nState.prototype.encode = function(full_domain, position_offset, option) {\r\n  var self = this\r\n\r\n  // [hbouvier] Added default value\r\n  var domain = full_domain || '';\r\n  domain = domain.replace(/\\.$/, '') // Strip the trailing dot.\r\n  position = self.position + (position_offset || 0)\r\n\r\n  var body = []\r\n    , bytes\r\n\r\n  var i = 0\r\n  var max_iterations = 40 // Enough for 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa\r\n\r\n  while(++i < max_iterations) {\r\n    if(domain == '') {\r\n      // Encode the root domain and be done.\r\n      body.push(new Buffer([0]))\r\n      return Buffer.concat(body)\r\n    }\r\n\r\n    else if(self.domains[domain] && option !== 'nocompress') {\r\n      // Encode a pointer and be done.\r\n      body.push(new Buffer([0xc0, self.domains[domain]]))\r\n      return Buffer.concat(body)\r\n    }\r\n\r\n    else {\r\n      // Encode the next part of the domain, saving its position in the lookup table for later.\r\n      self.domains[domain] = position\r\n\r\n      var parts = domain.split(/\\./)\r\n        , car = parts[0]\r\n      domain = parts.slice(1).join('.')\r\n\r\n      // Write the first part of the domain, with a length prefix.\r\n      //var part = parts[0]\r\n      var buf = new Buffer(car.length + 1)\r\n      buf.write(car, 1, car.length, 'ascii')\r\n      buf.writeUInt8(car.length, 0)\r\n      body.push(buf)\r\n      position += buf.length\r\n      //bytes.unshift(bytes.length)\r\n    }\r\n  }\r\n\r\n  throw new Error('Too many iterations encoding domain: ' + full_domain)\r\n}\r\n\r\n\r\n//\r\n// Utilities\r\n//\r\n\r\nfunction buf32(value) {\r\n  var buf = new Buffer(4)\r\n  buf.writeUInt32BE(value, 0)\r\n  return buf\r\n}\r\n\r\nfunction buf16(value) {\r\n  var buf = new Buffer(2)\r\n  buf.writeUInt16BE(value, 0)\r\n  return buf\r\n}\r\n\r\nfunction flat(data) {\r\n  return Buffer.isBuffer(data)\r\n          ? Array.prototype.slice.call(data)\r\n          : Array.isArray(data)\r\n            ? data.reduce(flatten, [])\r\n            : [data]\r\n}\r\n\r\nfunction flatten(state, element) {\r\n  return (Buffer.isBuffer(element) || Array.isArray(element))\r\n          ? state.concat(flat(element))\r\n          : state.concat([element])\r\n}\r\n\r\nfunction pair_to_buf(pair) {\r\n  // [hbouvier]  It is possible that the \"pair\" has less than 4 digits, lets\r\n  //             make sure that it has.\r\n  var pairLength = pair.length;\r\n  if (pairLength < 4)\r\n    pair = \"0000\".substring(pairLength) + pair;\r\n\r\n  // Convert a string of two hex bytes, e.g. \"89ab\" to a buffer.\r\n  if(! pair.match(/^[0-9a-fA-F]{4}$/))\r\n    throw new Error('Bad '+record.type+' record data: ' + JSON.stringify(record))\r\n  return new Buffer(pair, 'hex')\r\n}\r\n\r\n// [hbouvier] More robust parsing of ipV6 address\r\nfunction ipv6_to_array(string) {\r\n  var fullAddress = ['0','0','0','0','0','0','0','0'];\r\n  // Remove the contiguous empty strings generated by '::' and keep ony one.\r\n  var numbers = string.split(/:/).reduce(function (previous, current) {\r\n    if (previous instanceof Array === false)\r\n      previous = [previous];\r\n    if (!(current === '' && previous[previous.length -1] === '')) {\r\n      previous.push(current)\r\n    }\r\n    return previous;\r\n  });\r\n  // Replace the single empty string, by the number of '0' that\r\n  // were \"missing\" (e.g. shortened address)\r\n  var merged = [].concat.apply([], numbers.map(function (num) {\r\n    return (num === '') ? fullAddress.slice(numbers.length -1): num;\r\n  }));\r\n  return merged;\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}