{"ast":null,"code":"const ASYMMETRIC_KEY_DETAILS_SUPPORTED = require('./asymmetricKeyDetailsSupported');\n\nconst RSA_PSS_KEY_DETAILS_SUPPORTED = require('./rsaPssKeyDetailsSupported');\n\nconst allowedAlgorithmsForKeys = {\n  'ec': ['ES256', 'ES384', 'ES512'],\n  'rsa': ['RS256', 'PS256', 'RS384', 'PS384', 'RS512', 'PS512'],\n  'rsa-pss': ['PS256', 'PS384', 'PS512']\n};\nconst allowedCurves = {\n  ES256: 'prime256v1',\n  ES384: 'secp384r1',\n  ES512: 'secp521r1'\n};\n\nmodule.exports = function (algorithm, key) {\n  if (!algorithm || !key) return;\n  const keyType = key.asymmetricKeyType;\n  if (!keyType) return;\n  const allowedAlgorithms = allowedAlgorithmsForKeys[keyType];\n\n  if (!allowedAlgorithms) {\n    throw new Error(`Unknown key type \"${keyType}\".`);\n  }\n\n  if (!allowedAlgorithms.includes(algorithm)) {\n    throw new Error(`\"alg\" parameter for \"${keyType}\" key type must be one of: ${allowedAlgorithms.join(', ')}.`);\n  }\n  /*\n   * Ignore the next block from test coverage because it gets executed\n   * conditionally depending on the Node version. Not ignoring it would\n   * prevent us from reaching the target % of coverage for versions of\n   * Node under 15.7.0.\n   */\n\n  /* istanbul ignore next */\n\n\n  if (ASYMMETRIC_KEY_DETAILS_SUPPORTED) {\n    switch (keyType) {\n      case 'ec':\n        const keyCurve = key.asymmetricKeyDetails.namedCurve;\n        const allowedCurve = allowedCurves[algorithm];\n\n        if (keyCurve !== allowedCurve) {\n          throw new Error(`\"alg\" parameter \"${algorithm}\" requires curve \"${allowedCurve}\".`);\n        }\n\n        break;\n\n      case 'rsa-pss':\n        if (RSA_PSS_KEY_DETAILS_SUPPORTED) {\n          const length = parseInt(algorithm.slice(-3), 10);\n          const {\n            hashAlgorithm,\n            mgf1HashAlgorithm,\n            saltLength\n          } = key.asymmetricKeyDetails;\n\n          if (hashAlgorithm !== `sha${length}` || mgf1HashAlgorithm !== hashAlgorithm) {\n            throw new Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of \"alg\" ${algorithm}.`);\n          }\n\n          if (saltLength !== undefined && saltLength > length >> 3) {\n            throw new Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of \"alg\" ${algorithm}.`);\n          }\n        }\n\n        break;\n    }\n  }\n};","map":{"version":3,"names":["ASYMMETRIC_KEY_DETAILS_SUPPORTED","require","RSA_PSS_KEY_DETAILS_SUPPORTED","allowedAlgorithmsForKeys","allowedCurves","ES256","ES384","ES512","module","exports","algorithm","key","keyType","asymmetricKeyType","allowedAlgorithms","Error","includes","join","keyCurve","asymmetricKeyDetails","namedCurve","allowedCurve","length","parseInt","slice","hashAlgorithm","mgf1HashAlgorithm","saltLength","undefined"],"sources":["C:/Users/Kamen/ML/AlgoTrader/my-app/node_modules/jsonwebtoken/lib/validateAsymmetricKey.js"],"sourcesContent":["const ASYMMETRIC_KEY_DETAILS_SUPPORTED = require('./asymmetricKeyDetailsSupported');\nconst RSA_PSS_KEY_DETAILS_SUPPORTED = require('./rsaPssKeyDetailsSupported');\n\nconst allowedAlgorithmsForKeys = {\n  'ec': ['ES256', 'ES384', 'ES512'],\n  'rsa': ['RS256', 'PS256', 'RS384', 'PS384', 'RS512', 'PS512'],\n  'rsa-pss': ['PS256', 'PS384', 'PS512']\n};\n\nconst allowedCurves = {\n  ES256: 'prime256v1',\n  ES384: 'secp384r1',\n  ES512: 'secp521r1',\n};\n\nmodule.exports = function(algorithm, key) {\n  if (!algorithm || !key) return;\n\n  const keyType = key.asymmetricKeyType;\n  if (!keyType) return;\n\n  const allowedAlgorithms = allowedAlgorithmsForKeys[keyType];\n\n  if (!allowedAlgorithms) {\n    throw new Error(`Unknown key type \"${keyType}\".`);\n  }\n\n  if (!allowedAlgorithms.includes(algorithm)) {\n    throw new Error(`\"alg\" parameter for \"${keyType}\" key type must be one of: ${allowedAlgorithms.join(', ')}.`)\n  }\n\n  /*\n   * Ignore the next block from test coverage because it gets executed\n   * conditionally depending on the Node version. Not ignoring it would\n   * prevent us from reaching the target % of coverage for versions of\n   * Node under 15.7.0.\n   */\n  /* istanbul ignore next */\n  if (ASYMMETRIC_KEY_DETAILS_SUPPORTED) {\n    switch (keyType) {\n    case 'ec':\n      const keyCurve = key.asymmetricKeyDetails.namedCurve;\n      const allowedCurve = allowedCurves[algorithm];\n\n      if (keyCurve !== allowedCurve) {\n        throw new Error(`\"alg\" parameter \"${algorithm}\" requires curve \"${allowedCurve}\".`);\n      }\n      break;\n\n    case 'rsa-pss':\n      if (RSA_PSS_KEY_DETAILS_SUPPORTED) {\n        const length = parseInt(algorithm.slice(-3), 10);\n        const { hashAlgorithm, mgf1HashAlgorithm, saltLength } = key.asymmetricKeyDetails;\n\n        if (hashAlgorithm !== `sha${length}` || mgf1HashAlgorithm !== hashAlgorithm) {\n          throw new Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of \"alg\" ${algorithm}.`);\n        }\n\n        if (saltLength !== undefined && saltLength > length >> 3) {\n          throw new Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of \"alg\" ${algorithm}.`)\n        }\n      }\n      break;\n    }\n  }\n}\n"],"mappings":"AAAA,MAAMA,gCAAgC,GAAGC,OAAO,CAAC,iCAAD,CAAhD;;AACA,MAAMC,6BAA6B,GAAGD,OAAO,CAAC,6BAAD,CAA7C;;AAEA,MAAME,wBAAwB,GAAG;EAC/B,MAAM,CAAC,OAAD,EAAU,OAAV,EAAmB,OAAnB,CADyB;EAE/B,OAAO,CAAC,OAAD,EAAU,OAAV,EAAmB,OAAnB,EAA4B,OAA5B,EAAqC,OAArC,EAA8C,OAA9C,CAFwB;EAG/B,WAAW,CAAC,OAAD,EAAU,OAAV,EAAmB,OAAnB;AAHoB,CAAjC;AAMA,MAAMC,aAAa,GAAG;EACpBC,KAAK,EAAE,YADa;EAEpBC,KAAK,EAAE,WAFa;EAGpBC,KAAK,EAAE;AAHa,CAAtB;;AAMAC,MAAM,CAACC,OAAP,GAAiB,UAASC,SAAT,EAAoBC,GAApB,EAAyB;EACxC,IAAI,CAACD,SAAD,IAAc,CAACC,GAAnB,EAAwB;EAExB,MAAMC,OAAO,GAAGD,GAAG,CAACE,iBAApB;EACA,IAAI,CAACD,OAAL,EAAc;EAEd,MAAME,iBAAiB,GAAGX,wBAAwB,CAACS,OAAD,CAAlD;;EAEA,IAAI,CAACE,iBAAL,EAAwB;IACtB,MAAM,IAAIC,KAAJ,CAAW,qBAAoBH,OAAQ,IAAvC,CAAN;EACD;;EAED,IAAI,CAACE,iBAAiB,CAACE,QAAlB,CAA2BN,SAA3B,CAAL,EAA4C;IAC1C,MAAM,IAAIK,KAAJ,CAAW,wBAAuBH,OAAQ,8BAA6BE,iBAAiB,CAACG,IAAlB,CAAuB,IAAvB,CAA6B,GAApG,CAAN;EACD;EAED;AACF;AACA;AACA;AACA;AACA;;EACE;;;EACA,IAAIjB,gCAAJ,EAAsC;IACpC,QAAQY,OAAR;MACA,KAAK,IAAL;QACE,MAAMM,QAAQ,GAAGP,GAAG,CAACQ,oBAAJ,CAAyBC,UAA1C;QACA,MAAMC,YAAY,GAAGjB,aAAa,CAACM,SAAD,CAAlC;;QAEA,IAAIQ,QAAQ,KAAKG,YAAjB,EAA+B;UAC7B,MAAM,IAAIN,KAAJ,CAAW,oBAAmBL,SAAU,qBAAoBW,YAAa,IAAzE,CAAN;QACD;;QACD;;MAEF,KAAK,SAAL;QACE,IAAInB,6BAAJ,EAAmC;UACjC,MAAMoB,MAAM,GAAGC,QAAQ,CAACb,SAAS,CAACc,KAAV,CAAgB,CAAC,CAAjB,CAAD,EAAsB,EAAtB,CAAvB;UACA,MAAM;YAAEC,aAAF;YAAiBC,iBAAjB;YAAoCC;UAApC,IAAmDhB,GAAG,CAACQ,oBAA7D;;UAEA,IAAIM,aAAa,KAAM,MAAKH,MAAO,EAA/B,IAAoCI,iBAAiB,KAAKD,aAA9D,EAA6E;YAC3E,MAAM,IAAIV,KAAJ,CAAW,gGAA+FL,SAAU,GAApH,CAAN;UACD;;UAED,IAAIiB,UAAU,KAAKC,SAAf,IAA4BD,UAAU,GAAGL,MAAM,IAAI,CAAvD,EAA0D;YACxD,MAAM,IAAIP,KAAJ,CAAW,4GAA2GL,SAAU,GAAhI,CAAN;UACD;QACF;;QACD;IAvBF;EAyBD;AACF,CAlDD"},"metadata":{},"sourceType":"script"}