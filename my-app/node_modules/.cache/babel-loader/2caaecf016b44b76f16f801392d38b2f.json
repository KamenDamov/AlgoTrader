{"ast":null,"code":"/*!\r\n * send\r\n * Copyright(c) 2012 TJ Holowaychuk\r\n * Copyright(c) 2014-2022 Douglas Christopher Wilson\r\n * MIT Licensed\r\n */\n'use strict';\n/**\r\n * Module dependencies.\r\n * @private\r\n */\n\nvar createError = require('http-errors');\n\nvar debug = require('debug')('send');\n\nvar deprecate = require('depd')('send');\n\nvar destroy = require('destroy');\n\nvar encodeUrl = require('encodeurl');\n\nvar escapeHtml = require('escape-html');\n\nvar etag = require('etag');\n\nvar fresh = require('fresh');\n\nvar fs = require('fs');\n\nvar mime = require('mime');\n\nvar ms = require('ms');\n\nvar onFinished = require('on-finished');\n\nvar parseRange = require('range-parser');\n\nvar path = require('path');\n\nvar statuses = require('statuses');\n\nvar Stream = require('stream');\n\nvar util = require('util');\n/**\r\n * Path function references.\r\n * @private\r\n */\n\n\nvar extname = path.extname;\nvar join = path.join;\nvar normalize = path.normalize;\nvar resolve = path.resolve;\nvar sep = path.sep;\n/**\r\n * Regular expression for identifying a bytes Range header.\r\n * @private\r\n */\n\nvar BYTES_RANGE_REGEXP = /^ *bytes=/;\n/**\r\n * Maximum value allowed for the max age.\r\n * @private\r\n */\n\nvar MAX_MAXAGE = 60 * 60 * 24 * 365 * 1000; // 1 year\n\n/**\r\n * Regular expression to match a path with a directory up component.\r\n * @private\r\n */\n\nvar UP_PATH_REGEXP = /(?:^|[\\\\/])\\.\\.(?:[\\\\/]|$)/;\n/**\r\n * Module exports.\r\n * @public\r\n */\n\nmodule.exports = send;\nmodule.exports.mime = mime;\n/**\r\n * Return a `SendStream` for `req` and `path`.\r\n *\r\n * @param {object} req\r\n * @param {string} path\r\n * @param {object} [options]\r\n * @return {SendStream}\r\n * @public\r\n */\n\nfunction send(req, path, options) {\n  return new SendStream(req, path, options);\n}\n/**\r\n * Initialize a `SendStream` with the given `path`.\r\n *\r\n * @param {Request} req\r\n * @param {String} path\r\n * @param {object} [options]\r\n * @private\r\n */\n\n\nfunction SendStream(req, path, options) {\n  Stream.call(this);\n  var opts = options || {};\n  this.options = opts;\n  this.path = path;\n  this.req = req;\n  this._acceptRanges = opts.acceptRanges !== undefined ? Boolean(opts.acceptRanges) : true;\n  this._cacheControl = opts.cacheControl !== undefined ? Boolean(opts.cacheControl) : true;\n  this._etag = opts.etag !== undefined ? Boolean(opts.etag) : true;\n  this._dotfiles = opts.dotfiles !== undefined ? opts.dotfiles : 'ignore';\n\n  if (this._dotfiles !== 'ignore' && this._dotfiles !== 'allow' && this._dotfiles !== 'deny') {\n    throw new TypeError('dotfiles option must be \"allow\", \"deny\", or \"ignore\"');\n  }\n\n  this._hidden = Boolean(opts.hidden);\n\n  if (opts.hidden !== undefined) {\n    deprecate('hidden: use dotfiles: \\'' + (this._hidden ? 'allow' : 'ignore') + '\\' instead');\n  } // legacy support\n\n\n  if (opts.dotfiles === undefined) {\n    this._dotfiles = undefined;\n  }\n\n  this._extensions = opts.extensions !== undefined ? normalizeList(opts.extensions, 'extensions option') : [];\n  this._immutable = opts.immutable !== undefined ? Boolean(opts.immutable) : false;\n  this._index = opts.index !== undefined ? normalizeList(opts.index, 'index option') : ['index.html'];\n  this._lastModified = opts.lastModified !== undefined ? Boolean(opts.lastModified) : true;\n  this._maxage = opts.maxAge || opts.maxage;\n  this._maxage = typeof this._maxage === 'string' ? ms(this._maxage) : Number(this._maxage);\n  this._maxage = !isNaN(this._maxage) ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE) : 0;\n  this._root = opts.root ? resolve(opts.root) : null;\n\n  if (!this._root && opts.from) {\n    this.from(opts.from);\n  }\n}\n/**\r\n * Inherits from `Stream`.\r\n */\n\n\nutil.inherits(SendStream, Stream);\n/**\r\n * Enable or disable etag generation.\r\n *\r\n * @param {Boolean} val\r\n * @return {SendStream}\r\n * @api public\r\n */\n\nSendStream.prototype.etag = deprecate.function(function etag(val) {\n  this._etag = Boolean(val);\n  debug('etag %s', this._etag);\n  return this;\n}, 'send.etag: pass etag as option');\n/**\r\n * Enable or disable \"hidden\" (dot) files.\r\n *\r\n * @param {Boolean} path\r\n * @return {SendStream}\r\n * @api public\r\n */\n\nSendStream.prototype.hidden = deprecate.function(function hidden(val) {\n  this._hidden = Boolean(val);\n  this._dotfiles = undefined;\n  debug('hidden %s', this._hidden);\n  return this;\n}, 'send.hidden: use dotfiles option');\n/**\r\n * Set index `paths`, set to a falsy\r\n * value to disable index support.\r\n *\r\n * @param {String|Boolean|Array} paths\r\n * @return {SendStream}\r\n * @api public\r\n */\n\nSendStream.prototype.index = deprecate.function(function index(paths) {\n  var index = !paths ? [] : normalizeList(paths, 'paths argument');\n  debug('index %o', paths);\n  this._index = index;\n  return this;\n}, 'send.index: pass index as option');\n/**\r\n * Set root `path`.\r\n *\r\n * @param {String} path\r\n * @return {SendStream}\r\n * @api public\r\n */\n\nSendStream.prototype.root = function root(path) {\n  this._root = resolve(String(path));\n  debug('root %s', this._root);\n  return this;\n};\n\nSendStream.prototype.from = deprecate.function(SendStream.prototype.root, 'send.from: pass root as option');\nSendStream.prototype.root = deprecate.function(SendStream.prototype.root, 'send.root: pass root as option');\n/**\r\n * Set max-age to `maxAge`.\r\n *\r\n * @param {Number} maxAge\r\n * @return {SendStream}\r\n * @api public\r\n */\n\nSendStream.prototype.maxage = deprecate.function(function maxage(maxAge) {\n  this._maxage = typeof maxAge === 'string' ? ms(maxAge) : Number(maxAge);\n  this._maxage = !isNaN(this._maxage) ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE) : 0;\n  debug('max-age %d', this._maxage);\n  return this;\n}, 'send.maxage: pass maxAge as option');\n/**\r\n * Emit error with `status`.\r\n *\r\n * @param {number} status\r\n * @param {Error} [err]\r\n * @private\r\n */\n\nSendStream.prototype.error = function error(status, err) {\n  // emit if listeners instead of responding\n  if (hasListeners(this, 'error')) {\n    return this.emit('error', createHttpError(status, err));\n  }\n\n  var res = this.res;\n  var msg = statuses.message[status] || String(status);\n  var doc = createHtmlDocument('Error', escapeHtml(msg)); // clear existing headers\n\n  clearHeaders(res); // add error headers\n\n  if (err && err.headers) {\n    setHeaders(res, err.headers);\n  } // send basic response\n\n\n  res.statusCode = status;\n  res.setHeader('Content-Type', 'text/html; charset=UTF-8');\n  res.setHeader('Content-Length', Buffer.byteLength(doc));\n  res.setHeader('Content-Security-Policy', \"default-src 'none'\");\n  res.setHeader('X-Content-Type-Options', 'nosniff');\n  res.end(doc);\n};\n/**\r\n * Check if the pathname ends with \"/\".\r\n *\r\n * @return {boolean}\r\n * @private\r\n */\n\n\nSendStream.prototype.hasTrailingSlash = function hasTrailingSlash() {\n  return this.path[this.path.length - 1] === '/';\n};\n/**\r\n * Check if this is a conditional GET request.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\n\n\nSendStream.prototype.isConditionalGET = function isConditionalGET() {\n  return this.req.headers['if-match'] || this.req.headers['if-unmodified-since'] || this.req.headers['if-none-match'] || this.req.headers['if-modified-since'];\n};\n/**\r\n * Check if the request preconditions failed.\r\n *\r\n * @return {boolean}\r\n * @private\r\n */\n\n\nSendStream.prototype.isPreconditionFailure = function isPreconditionFailure() {\n  var req = this.req;\n  var res = this.res; // if-match\n\n  var match = req.headers['if-match'];\n\n  if (match) {\n    var etag = res.getHeader('ETag');\n    return !etag || match !== '*' && parseTokenList(match).every(function (match) {\n      return match !== etag && match !== 'W/' + etag && 'W/' + match !== etag;\n    });\n  } // if-unmodified-since\n\n\n  var unmodifiedSince = parseHttpDate(req.headers['if-unmodified-since']);\n\n  if (!isNaN(unmodifiedSince)) {\n    var lastModified = parseHttpDate(res.getHeader('Last-Modified'));\n    return isNaN(lastModified) || lastModified > unmodifiedSince;\n  }\n\n  return false;\n};\n/**\r\n * Strip various content header fields for a change in entity.\r\n *\r\n * @private\r\n */\n\n\nSendStream.prototype.removeContentHeaderFields = function removeContentHeaderFields() {\n  var res = this.res;\n  res.removeHeader('Content-Encoding');\n  res.removeHeader('Content-Language');\n  res.removeHeader('Content-Length');\n  res.removeHeader('Content-Range');\n  res.removeHeader('Content-Type');\n};\n/**\r\n * Respond with 304 not modified.\r\n *\r\n * @api private\r\n */\n\n\nSendStream.prototype.notModified = function notModified() {\n  var res = this.res;\n  debug('not modified');\n  this.removeContentHeaderFields();\n  res.statusCode = 304;\n  res.end();\n};\n/**\r\n * Raise error that headers already sent.\r\n *\r\n * @api private\r\n */\n\n\nSendStream.prototype.headersAlreadySent = function headersAlreadySent() {\n  var err = new Error('Can\\'t set headers after they are sent.');\n  debug('headers already sent');\n  this.error(500, err);\n};\n/**\r\n * Check if the request is cacheable, aka\r\n * responded with 2xx or 304 (see RFC 2616 section 14.2{5,6}).\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\n\n\nSendStream.prototype.isCachable = function isCachable() {\n  var statusCode = this.res.statusCode;\n  return statusCode >= 200 && statusCode < 300 || statusCode === 304;\n};\n/**\r\n * Handle stat() error.\r\n *\r\n * @param {Error} error\r\n * @private\r\n */\n\n\nSendStream.prototype.onStatError = function onStatError(error) {\n  switch (error.code) {\n    case 'ENAMETOOLONG':\n    case 'ENOENT':\n    case 'ENOTDIR':\n      this.error(404, error);\n      break;\n\n    default:\n      this.error(500, error);\n      break;\n  }\n};\n/**\r\n * Check if the cache is fresh.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\n\n\nSendStream.prototype.isFresh = function isFresh() {\n  return fresh(this.req.headers, {\n    etag: this.res.getHeader('ETag'),\n    'last-modified': this.res.getHeader('Last-Modified')\n  });\n};\n/**\r\n * Check if the range is fresh.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\n\n\nSendStream.prototype.isRangeFresh = function isRangeFresh() {\n  var ifRange = this.req.headers['if-range'];\n\n  if (!ifRange) {\n    return true;\n  } // if-range as etag\n\n\n  if (ifRange.indexOf('\"') !== -1) {\n    var etag = this.res.getHeader('ETag');\n    return Boolean(etag && ifRange.indexOf(etag) !== -1);\n  } // if-range as modified date\n\n\n  var lastModified = this.res.getHeader('Last-Modified');\n  return parseHttpDate(lastModified) <= parseHttpDate(ifRange);\n};\n/**\r\n * Redirect to path.\r\n *\r\n * @param {string} path\r\n * @private\r\n */\n\n\nSendStream.prototype.redirect = function redirect(path) {\n  var res = this.res;\n\n  if (hasListeners(this, 'directory')) {\n    this.emit('directory', res, path);\n    return;\n  }\n\n  if (this.hasTrailingSlash()) {\n    this.error(403);\n    return;\n  }\n\n  var loc = encodeUrl(collapseLeadingSlashes(this.path + '/'));\n  var doc = createHtmlDocument('Redirecting', 'Redirecting to <a href=\"' + escapeHtml(loc) + '\">' + escapeHtml(loc) + '</a>'); // redirect\n\n  res.statusCode = 301;\n  res.setHeader('Content-Type', 'text/html; charset=UTF-8');\n  res.setHeader('Content-Length', Buffer.byteLength(doc));\n  res.setHeader('Content-Security-Policy', \"default-src 'none'\");\n  res.setHeader('X-Content-Type-Options', 'nosniff');\n  res.setHeader('Location', loc);\n  res.end(doc);\n};\n/**\r\n * Pipe to `res.\r\n *\r\n * @param {Stream} res\r\n * @return {Stream} res\r\n * @api public\r\n */\n\n\nSendStream.prototype.pipe = function pipe(res) {\n  // root path\n  var root = this._root; // references\n\n  this.res = res; // decode the path\n\n  var path = decode(this.path);\n\n  if (path === -1) {\n    this.error(400);\n    return res;\n  } // null byte(s)\n\n\n  if (~path.indexOf('\\0')) {\n    this.error(400);\n    return res;\n  }\n\n  var parts;\n\n  if (root !== null) {\n    // normalize\n    if (path) {\n      path = normalize('.' + sep + path);\n    } // malicious path\n\n\n    if (UP_PATH_REGEXP.test(path)) {\n      debug('malicious path \"%s\"', path);\n      this.error(403);\n      return res;\n    } // explode path parts\n\n\n    parts = path.split(sep); // join / normalize from optional root dir\n\n    path = normalize(join(root, path));\n  } else {\n    // \"..\" is malicious without \"root\"\n    if (UP_PATH_REGEXP.test(path)) {\n      debug('malicious path \"%s\"', path);\n      this.error(403);\n      return res;\n    } // explode path parts\n\n\n    parts = normalize(path).split(sep); // resolve the path\n\n    path = resolve(path);\n  } // dotfile handling\n\n\n  if (containsDotFile(parts)) {\n    var access = this._dotfiles; // legacy support\n\n    if (access === undefined) {\n      access = parts[parts.length - 1][0] === '.' ? this._hidden ? 'allow' : 'ignore' : 'allow';\n    }\n\n    debug('%s dotfile \"%s\"', access, path);\n\n    switch (access) {\n      case 'allow':\n        break;\n\n      case 'deny':\n        this.error(403);\n        return res;\n\n      case 'ignore':\n      default:\n        this.error(404);\n        return res;\n    }\n  } // index file support\n\n\n  if (this._index.length && this.hasTrailingSlash()) {\n    this.sendIndex(path);\n    return res;\n  }\n\n  this.sendFile(path);\n  return res;\n};\n/**\r\n * Transfer `path`.\r\n *\r\n * @param {String} path\r\n * @api public\r\n */\n\n\nSendStream.prototype.send = function send(path, stat) {\n  var len = stat.size;\n  var options = this.options;\n  var opts = {};\n  var res = this.res;\n  var req = this.req;\n  var ranges = req.headers.range;\n  var offset = options.start || 0;\n\n  if (headersSent(res)) {\n    // impossible to send now\n    this.headersAlreadySent();\n    return;\n  }\n\n  debug('pipe \"%s\"', path); // set header fields\n\n  this.setHeader(path, stat); // set content-type\n\n  this.type(path); // conditional GET support\n\n  if (this.isConditionalGET()) {\n    if (this.isPreconditionFailure()) {\n      this.error(412);\n      return;\n    }\n\n    if (this.isCachable() && this.isFresh()) {\n      this.notModified();\n      return;\n    }\n  } // adjust len to start/end options\n\n\n  len = Math.max(0, len - offset);\n\n  if (options.end !== undefined) {\n    var bytes = options.end - offset + 1;\n    if (len > bytes) len = bytes;\n  } // Range support\n\n\n  if (this._acceptRanges && BYTES_RANGE_REGEXP.test(ranges)) {\n    // parse\n    ranges = parseRange(len, ranges, {\n      combine: true\n    }); // If-Range support\n\n    if (!this.isRangeFresh()) {\n      debug('range stale');\n      ranges = -2;\n    } // unsatisfiable\n\n\n    if (ranges === -1) {\n      debug('range unsatisfiable'); // Content-Range\n\n      res.setHeader('Content-Range', contentRange('bytes', len)); // 416 Requested Range Not Satisfiable\n\n      return this.error(416, {\n        headers: {\n          'Content-Range': res.getHeader('Content-Range')\n        }\n      });\n    } // valid (syntactically invalid/multiple ranges are treated as a regular response)\n\n\n    if (ranges !== -2 && ranges.length === 1) {\n      debug('range %j', ranges); // Content-Range\n\n      res.statusCode = 206;\n      res.setHeader('Content-Range', contentRange('bytes', len, ranges[0])); // adjust for requested range\n\n      offset += ranges[0].start;\n      len = ranges[0].end - ranges[0].start + 1;\n    }\n  } // clone options\n\n\n  for (var prop in options) {\n    opts[prop] = options[prop];\n  } // set read options\n\n\n  opts.start = offset;\n  opts.end = Math.max(offset, offset + len - 1); // content-length\n\n  res.setHeader('Content-Length', len); // HEAD support\n\n  if (req.method === 'HEAD') {\n    res.end();\n    return;\n  }\n\n  this.stream(path, opts);\n};\n/**\r\n * Transfer file for `path`.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\n\n\nSendStream.prototype.sendFile = function sendFile(path) {\n  var i = 0;\n  var self = this;\n  debug('stat \"%s\"', path);\n  fs.stat(path, function onstat(err, stat) {\n    if (err && err.code === 'ENOENT' && !extname(path) && path[path.length - 1] !== sep) {\n      // not found, check extensions\n      return next(err);\n    }\n\n    if (err) return self.onStatError(err);\n    if (stat.isDirectory()) return self.redirect(path);\n    self.emit('file', path, stat);\n    self.send(path, stat);\n  });\n\n  function next(err) {\n    if (self._extensions.length <= i) {\n      return err ? self.onStatError(err) : self.error(404);\n    }\n\n    var p = path + '.' + self._extensions[i++];\n    debug('stat \"%s\"', p);\n    fs.stat(p, function (err, stat) {\n      if (err) return next(err);\n      if (stat.isDirectory()) return next();\n      self.emit('file', p, stat);\n      self.send(p, stat);\n    });\n  }\n};\n/**\r\n * Transfer index for `path`.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\n\n\nSendStream.prototype.sendIndex = function sendIndex(path) {\n  var i = -1;\n  var self = this;\n\n  function next(err) {\n    if (++i >= self._index.length) {\n      if (err) return self.onStatError(err);\n      return self.error(404);\n    }\n\n    var p = join(path, self._index[i]);\n    debug('stat \"%s\"', p);\n    fs.stat(p, function (err, stat) {\n      if (err) return next(err);\n      if (stat.isDirectory()) return next();\n      self.emit('file', p, stat);\n      self.send(p, stat);\n    });\n  }\n\n  next();\n};\n/**\r\n * Stream `path` to the response.\r\n *\r\n * @param {String} path\r\n * @param {Object} options\r\n * @api private\r\n */\n\n\nSendStream.prototype.stream = function stream(path, options) {\n  var self = this;\n  var res = this.res; // pipe\n\n  var stream = fs.createReadStream(path, options);\n  this.emit('stream', stream);\n  stream.pipe(res); // cleanup\n\n  function cleanup() {\n    destroy(stream, true);\n  } // response finished, cleanup\n\n\n  onFinished(res, cleanup); // error handling\n\n  stream.on('error', function onerror(err) {\n    // clean up stream early\n    cleanup(); // error\n\n    self.onStatError(err);\n  }); // end\n\n  stream.on('end', function onend() {\n    self.emit('end');\n  });\n};\n/**\r\n * Set content-type based on `path`\r\n * if it hasn't been explicitly set.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\n\n\nSendStream.prototype.type = function type(path) {\n  var res = this.res;\n  if (res.getHeader('Content-Type')) return;\n  var type = mime.lookup(path);\n\n  if (!type) {\n    debug('no content-type');\n    return;\n  }\n\n  var charset = mime.charsets.lookup(type);\n  debug('content-type %s', type);\n  res.setHeader('Content-Type', type + (charset ? '; charset=' + charset : ''));\n};\n/**\r\n * Set response header fields, most\r\n * fields may be pre-defined.\r\n *\r\n * @param {String} path\r\n * @param {Object} stat\r\n * @api private\r\n */\n\n\nSendStream.prototype.setHeader = function setHeader(path, stat) {\n  var res = this.res;\n  this.emit('headers', res, path, stat);\n\n  if (this._acceptRanges && !res.getHeader('Accept-Ranges')) {\n    debug('accept ranges');\n    res.setHeader('Accept-Ranges', 'bytes');\n  }\n\n  if (this._cacheControl && !res.getHeader('Cache-Control')) {\n    var cacheControl = 'public, max-age=' + Math.floor(this._maxage / 1000);\n\n    if (this._immutable) {\n      cacheControl += ', immutable';\n    }\n\n    debug('cache-control %s', cacheControl);\n    res.setHeader('Cache-Control', cacheControl);\n  }\n\n  if (this._lastModified && !res.getHeader('Last-Modified')) {\n    var modified = stat.mtime.toUTCString();\n    debug('modified %s', modified);\n    res.setHeader('Last-Modified', modified);\n  }\n\n  if (this._etag && !res.getHeader('ETag')) {\n    var val = etag(stat);\n    debug('etag %s', val);\n    res.setHeader('ETag', val);\n  }\n};\n/**\r\n * Clear all headers from a response.\r\n *\r\n * @param {object} res\r\n * @private\r\n */\n\n\nfunction clearHeaders(res) {\n  var headers = getHeaderNames(res);\n\n  for (var i = 0; i < headers.length; i++) {\n    res.removeHeader(headers[i]);\n  }\n}\n/**\r\n * Collapse all leading slashes into a single slash\r\n *\r\n * @param {string} str\r\n * @private\r\n */\n\n\nfunction collapseLeadingSlashes(str) {\n  for (var i = 0; i < str.length; i++) {\n    if (str[i] !== '/') {\n      break;\n    }\n  }\n\n  return i > 1 ? '/' + str.substr(i) : str;\n}\n/**\r\n * Determine if path parts contain a dotfile.\r\n *\r\n * @api private\r\n */\n\n\nfunction containsDotFile(parts) {\n  for (var i = 0; i < parts.length; i++) {\n    var part = parts[i];\n\n    if (part.length > 1 && part[0] === '.') {\n      return true;\n    }\n  }\n\n  return false;\n}\n/**\r\n * Create a Content-Range header.\r\n *\r\n * @param {string} type\r\n * @param {number} size\r\n * @param {array} [range]\r\n */\n\n\nfunction contentRange(type, size, range) {\n  return type + ' ' + (range ? range.start + '-' + range.end : '*') + '/' + size;\n}\n/**\r\n * Create a minimal HTML document.\r\n *\r\n * @param {string} title\r\n * @param {string} body\r\n * @private\r\n */\n\n\nfunction createHtmlDocument(title, body) {\n  return '<!DOCTYPE html>\\n' + '<html lang=\"en\">\\n' + '<head>\\n' + '<meta charset=\"utf-8\">\\n' + '<title>' + title + '</title>\\n' + '</head>\\n' + '<body>\\n' + '<pre>' + body + '</pre>\\n' + '</body>\\n' + '</html>\\n';\n}\n/**\r\n * Create a HttpError object from simple arguments.\r\n *\r\n * @param {number} status\r\n * @param {Error|object} err\r\n * @private\r\n */\n\n\nfunction createHttpError(status, err) {\n  if (!err) {\n    return createError(status);\n  }\n\n  return err instanceof Error ? createError(status, err, {\n    expose: false\n  }) : createError(status, err);\n}\n/**\r\n * decodeURIComponent.\r\n *\r\n * Allows V8 to only deoptimize this fn instead of all\r\n * of send().\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\n\n\nfunction decode(path) {\n  try {\n    return decodeURIComponent(path);\n  } catch (err) {\n    return -1;\n  }\n}\n/**\r\n * Get the header names on a respnse.\r\n *\r\n * @param {object} res\r\n * @returns {array[string]}\r\n * @private\r\n */\n\n\nfunction getHeaderNames(res) {\n  return typeof res.getHeaderNames !== 'function' ? Object.keys(res._headers || {}) : res.getHeaderNames();\n}\n/**\r\n * Determine if emitter has listeners of a given type.\r\n *\r\n * The way to do this check is done three different ways in Node.js >= 0.8\r\n * so this consolidates them into a minimal set using instance methods.\r\n *\r\n * @param {EventEmitter} emitter\r\n * @param {string} type\r\n * @returns {boolean}\r\n * @private\r\n */\n\n\nfunction hasListeners(emitter, type) {\n  var count = typeof emitter.listenerCount !== 'function' ? emitter.listeners(type).length : emitter.listenerCount(type);\n  return count > 0;\n}\n/**\r\n * Determine if the response headers have been sent.\r\n *\r\n * @param {object} res\r\n * @returns {boolean}\r\n * @private\r\n */\n\n\nfunction headersSent(res) {\n  return typeof res.headersSent !== 'boolean' ? Boolean(res._header) : res.headersSent;\n}\n/**\r\n * Normalize the index option into an array.\r\n *\r\n * @param {boolean|string|array} val\r\n * @param {string} name\r\n * @private\r\n */\n\n\nfunction normalizeList(val, name) {\n  var list = [].concat(val || []);\n\n  for (var i = 0; i < list.length; i++) {\n    if (typeof list[i] !== 'string') {\n      throw new TypeError(name + ' must be array of strings or false');\n    }\n  }\n\n  return list;\n}\n/**\r\n * Parse an HTTP Date into a number.\r\n *\r\n * @param {string} date\r\n * @private\r\n */\n\n\nfunction parseHttpDate(date) {\n  var timestamp = date && Date.parse(date);\n  return typeof timestamp === 'number' ? timestamp : NaN;\n}\n/**\r\n * Parse a HTTP token list.\r\n *\r\n * @param {string} str\r\n * @private\r\n */\n\n\nfunction parseTokenList(str) {\n  var end = 0;\n  var list = [];\n  var start = 0; // gather tokens\n\n  for (var i = 0, len = str.length; i < len; i++) {\n    switch (str.charCodeAt(i)) {\n      case 0x20:\n        /*   */\n        if (start === end) {\n          start = end = i + 1;\n        }\n\n        break;\n\n      case 0x2c:\n        /* , */\n        if (start !== end) {\n          list.push(str.substring(start, end));\n        }\n\n        start = end = i + 1;\n        break;\n\n      default:\n        end = i + 1;\n        break;\n    }\n  } // final token\n\n\n  if (start !== end) {\n    list.push(str.substring(start, end));\n  }\n\n  return list;\n}\n/**\r\n * Set an object of headers on a response.\r\n *\r\n * @param {object} res\r\n * @param {object} headers\r\n * @private\r\n */\n\n\nfunction setHeaders(res, headers) {\n  var keys = Object.keys(headers);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    res.setHeader(key, headers[key]);\n  }\n}","map":{"version":3,"names":["createError","require","debug","deprecate","destroy","encodeUrl","escapeHtml","etag","fresh","fs","mime","ms","onFinished","parseRange","path","statuses","Stream","util","extname","join","normalize","resolve","sep","BYTES_RANGE_REGEXP","MAX_MAXAGE","UP_PATH_REGEXP","module","exports","send","req","options","SendStream","call","opts","_acceptRanges","acceptRanges","undefined","Boolean","_cacheControl","cacheControl","_etag","_dotfiles","dotfiles","TypeError","_hidden","hidden","_extensions","extensions","normalizeList","_immutable","immutable","_index","index","_lastModified","lastModified","_maxage","maxAge","maxage","Number","isNaN","Math","min","max","_root","root","from","inherits","prototype","function","val","paths","String","error","status","err","hasListeners","emit","createHttpError","res","msg","message","doc","createHtmlDocument","clearHeaders","headers","setHeaders","statusCode","setHeader","Buffer","byteLength","end","hasTrailingSlash","length","isConditionalGET","isPreconditionFailure","match","getHeader","parseTokenList","every","unmodifiedSince","parseHttpDate","removeContentHeaderFields","removeHeader","notModified","headersAlreadySent","Error","isCachable","onStatError","code","isFresh","isRangeFresh","ifRange","indexOf","redirect","loc","collapseLeadingSlashes","pipe","decode","parts","test","split","containsDotFile","access","sendIndex","sendFile","stat","len","size","ranges","range","offset","start","headersSent","type","bytes","combine","contentRange","prop","method","stream","i","self","onstat","next","isDirectory","p","createReadStream","cleanup","on","onerror","onend","lookup","charset","charsets","floor","modified","mtime","toUTCString","getHeaderNames","str","substr","part","title","body","expose","decodeURIComponent","Object","keys","_headers","emitter","count","listenerCount","listeners","_header","name","list","concat","date","timestamp","Date","parse","NaN","charCodeAt","push","substring","key"],"sources":["C:/Users/Kamen/ML/AlgoTrader/my-app/node_modules/send/index.js"],"sourcesContent":["/*!\r\n * send\r\n * Copyright(c) 2012 TJ Holowaychuk\r\n * Copyright(c) 2014-2022 Douglas Christopher Wilson\r\n * MIT Licensed\r\n */\r\n\r\n'use strict'\r\n\r\n/**\r\n * Module dependencies.\r\n * @private\r\n */\r\n\r\nvar createError = require('http-errors')\r\nvar debug = require('debug')('send')\r\nvar deprecate = require('depd')('send')\r\nvar destroy = require('destroy')\r\nvar encodeUrl = require('encodeurl')\r\nvar escapeHtml = require('escape-html')\r\nvar etag = require('etag')\r\nvar fresh = require('fresh')\r\nvar fs = require('fs')\r\nvar mime = require('mime')\r\nvar ms = require('ms')\r\nvar onFinished = require('on-finished')\r\nvar parseRange = require('range-parser')\r\nvar path = require('path')\r\nvar statuses = require('statuses')\r\nvar Stream = require('stream')\r\nvar util = require('util')\r\n\r\n/**\r\n * Path function references.\r\n * @private\r\n */\r\n\r\nvar extname = path.extname\r\nvar join = path.join\r\nvar normalize = path.normalize\r\nvar resolve = path.resolve\r\nvar sep = path.sep\r\n\r\n/**\r\n * Regular expression for identifying a bytes Range header.\r\n * @private\r\n */\r\n\r\nvar BYTES_RANGE_REGEXP = /^ *bytes=/\r\n\r\n/**\r\n * Maximum value allowed for the max age.\r\n * @private\r\n */\r\n\r\nvar MAX_MAXAGE = 60 * 60 * 24 * 365 * 1000 // 1 year\r\n\r\n/**\r\n * Regular expression to match a path with a directory up component.\r\n * @private\r\n */\r\n\r\nvar UP_PATH_REGEXP = /(?:^|[\\\\/])\\.\\.(?:[\\\\/]|$)/\r\n\r\n/**\r\n * Module exports.\r\n * @public\r\n */\r\n\r\nmodule.exports = send\r\nmodule.exports.mime = mime\r\n\r\n/**\r\n * Return a `SendStream` for `req` and `path`.\r\n *\r\n * @param {object} req\r\n * @param {string} path\r\n * @param {object} [options]\r\n * @return {SendStream}\r\n * @public\r\n */\r\n\r\nfunction send (req, path, options) {\r\n  return new SendStream(req, path, options)\r\n}\r\n\r\n/**\r\n * Initialize a `SendStream` with the given `path`.\r\n *\r\n * @param {Request} req\r\n * @param {String} path\r\n * @param {object} [options]\r\n * @private\r\n */\r\n\r\nfunction SendStream (req, path, options) {\r\n  Stream.call(this)\r\n\r\n  var opts = options || {}\r\n\r\n  this.options = opts\r\n  this.path = path\r\n  this.req = req\r\n\r\n  this._acceptRanges = opts.acceptRanges !== undefined\r\n    ? Boolean(opts.acceptRanges)\r\n    : true\r\n\r\n  this._cacheControl = opts.cacheControl !== undefined\r\n    ? Boolean(opts.cacheControl)\r\n    : true\r\n\r\n  this._etag = opts.etag !== undefined\r\n    ? Boolean(opts.etag)\r\n    : true\r\n\r\n  this._dotfiles = opts.dotfiles !== undefined\r\n    ? opts.dotfiles\r\n    : 'ignore'\r\n\r\n  if (this._dotfiles !== 'ignore' && this._dotfiles !== 'allow' && this._dotfiles !== 'deny') {\r\n    throw new TypeError('dotfiles option must be \"allow\", \"deny\", or \"ignore\"')\r\n  }\r\n\r\n  this._hidden = Boolean(opts.hidden)\r\n\r\n  if (opts.hidden !== undefined) {\r\n    deprecate('hidden: use dotfiles: \\'' + (this._hidden ? 'allow' : 'ignore') + '\\' instead')\r\n  }\r\n\r\n  // legacy support\r\n  if (opts.dotfiles === undefined) {\r\n    this._dotfiles = undefined\r\n  }\r\n\r\n  this._extensions = opts.extensions !== undefined\r\n    ? normalizeList(opts.extensions, 'extensions option')\r\n    : []\r\n\r\n  this._immutable = opts.immutable !== undefined\r\n    ? Boolean(opts.immutable)\r\n    : false\r\n\r\n  this._index = opts.index !== undefined\r\n    ? normalizeList(opts.index, 'index option')\r\n    : ['index.html']\r\n\r\n  this._lastModified = opts.lastModified !== undefined\r\n    ? Boolean(opts.lastModified)\r\n    : true\r\n\r\n  this._maxage = opts.maxAge || opts.maxage\r\n  this._maxage = typeof this._maxage === 'string'\r\n    ? ms(this._maxage)\r\n    : Number(this._maxage)\r\n  this._maxage = !isNaN(this._maxage)\r\n    ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE)\r\n    : 0\r\n\r\n  this._root = opts.root\r\n    ? resolve(opts.root)\r\n    : null\r\n\r\n  if (!this._root && opts.from) {\r\n    this.from(opts.from)\r\n  }\r\n}\r\n\r\n/**\r\n * Inherits from `Stream`.\r\n */\r\n\r\nutil.inherits(SendStream, Stream)\r\n\r\n/**\r\n * Enable or disable etag generation.\r\n *\r\n * @param {Boolean} val\r\n * @return {SendStream}\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.etag = deprecate.function(function etag (val) {\r\n  this._etag = Boolean(val)\r\n  debug('etag %s', this._etag)\r\n  return this\r\n}, 'send.etag: pass etag as option')\r\n\r\n/**\r\n * Enable or disable \"hidden\" (dot) files.\r\n *\r\n * @param {Boolean} path\r\n * @return {SendStream}\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.hidden = deprecate.function(function hidden (val) {\r\n  this._hidden = Boolean(val)\r\n  this._dotfiles = undefined\r\n  debug('hidden %s', this._hidden)\r\n  return this\r\n}, 'send.hidden: use dotfiles option')\r\n\r\n/**\r\n * Set index `paths`, set to a falsy\r\n * value to disable index support.\r\n *\r\n * @param {String|Boolean|Array} paths\r\n * @return {SendStream}\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.index = deprecate.function(function index (paths) {\r\n  var index = !paths ? [] : normalizeList(paths, 'paths argument')\r\n  debug('index %o', paths)\r\n  this._index = index\r\n  return this\r\n}, 'send.index: pass index as option')\r\n\r\n/**\r\n * Set root `path`.\r\n *\r\n * @param {String} path\r\n * @return {SendStream}\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.root = function root (path) {\r\n  this._root = resolve(String(path))\r\n  debug('root %s', this._root)\r\n  return this\r\n}\r\n\r\nSendStream.prototype.from = deprecate.function(SendStream.prototype.root,\r\n  'send.from: pass root as option')\r\n\r\nSendStream.prototype.root = deprecate.function(SendStream.prototype.root,\r\n  'send.root: pass root as option')\r\n\r\n/**\r\n * Set max-age to `maxAge`.\r\n *\r\n * @param {Number} maxAge\r\n * @return {SendStream}\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.maxage = deprecate.function(function maxage (maxAge) {\r\n  this._maxage = typeof maxAge === 'string'\r\n    ? ms(maxAge)\r\n    : Number(maxAge)\r\n  this._maxage = !isNaN(this._maxage)\r\n    ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE)\r\n    : 0\r\n  debug('max-age %d', this._maxage)\r\n  return this\r\n}, 'send.maxage: pass maxAge as option')\r\n\r\n/**\r\n * Emit error with `status`.\r\n *\r\n * @param {number} status\r\n * @param {Error} [err]\r\n * @private\r\n */\r\n\r\nSendStream.prototype.error = function error (status, err) {\r\n  // emit if listeners instead of responding\r\n  if (hasListeners(this, 'error')) {\r\n    return this.emit('error', createHttpError(status, err))\r\n  }\r\n\r\n  var res = this.res\r\n  var msg = statuses.message[status] || String(status)\r\n  var doc = createHtmlDocument('Error', escapeHtml(msg))\r\n\r\n  // clear existing headers\r\n  clearHeaders(res)\r\n\r\n  // add error headers\r\n  if (err && err.headers) {\r\n    setHeaders(res, err.headers)\r\n  }\r\n\r\n  // send basic response\r\n  res.statusCode = status\r\n  res.setHeader('Content-Type', 'text/html; charset=UTF-8')\r\n  res.setHeader('Content-Length', Buffer.byteLength(doc))\r\n  res.setHeader('Content-Security-Policy', \"default-src 'none'\")\r\n  res.setHeader('X-Content-Type-Options', 'nosniff')\r\n  res.end(doc)\r\n}\r\n\r\n/**\r\n * Check if the pathname ends with \"/\".\r\n *\r\n * @return {boolean}\r\n * @private\r\n */\r\n\r\nSendStream.prototype.hasTrailingSlash = function hasTrailingSlash () {\r\n  return this.path[this.path.length - 1] === '/'\r\n}\r\n\r\n/**\r\n * Check if this is a conditional GET request.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.isConditionalGET = function isConditionalGET () {\r\n  return this.req.headers['if-match'] ||\r\n    this.req.headers['if-unmodified-since'] ||\r\n    this.req.headers['if-none-match'] ||\r\n    this.req.headers['if-modified-since']\r\n}\r\n\r\n/**\r\n * Check if the request preconditions failed.\r\n *\r\n * @return {boolean}\r\n * @private\r\n */\r\n\r\nSendStream.prototype.isPreconditionFailure = function isPreconditionFailure () {\r\n  var req = this.req\r\n  var res = this.res\r\n\r\n  // if-match\r\n  var match = req.headers['if-match']\r\n  if (match) {\r\n    var etag = res.getHeader('ETag')\r\n    return !etag || (match !== '*' && parseTokenList(match).every(function (match) {\r\n      return match !== etag && match !== 'W/' + etag && 'W/' + match !== etag\r\n    }))\r\n  }\r\n\r\n  // if-unmodified-since\r\n  var unmodifiedSince = parseHttpDate(req.headers['if-unmodified-since'])\r\n  if (!isNaN(unmodifiedSince)) {\r\n    var lastModified = parseHttpDate(res.getHeader('Last-Modified'))\r\n    return isNaN(lastModified) || lastModified > unmodifiedSince\r\n  }\r\n\r\n  return false\r\n}\r\n\r\n/**\r\n * Strip various content header fields for a change in entity.\r\n *\r\n * @private\r\n */\r\n\r\nSendStream.prototype.removeContentHeaderFields = function removeContentHeaderFields () {\r\n  var res = this.res\r\n\r\n  res.removeHeader('Content-Encoding')\r\n  res.removeHeader('Content-Language')\r\n  res.removeHeader('Content-Length')\r\n  res.removeHeader('Content-Range')\r\n  res.removeHeader('Content-Type')\r\n}\r\n\r\n/**\r\n * Respond with 304 not modified.\r\n *\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.notModified = function notModified () {\r\n  var res = this.res\r\n  debug('not modified')\r\n  this.removeContentHeaderFields()\r\n  res.statusCode = 304\r\n  res.end()\r\n}\r\n\r\n/**\r\n * Raise error that headers already sent.\r\n *\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.headersAlreadySent = function headersAlreadySent () {\r\n  var err = new Error('Can\\'t set headers after they are sent.')\r\n  debug('headers already sent')\r\n  this.error(500, err)\r\n}\r\n\r\n/**\r\n * Check if the request is cacheable, aka\r\n * responded with 2xx or 304 (see RFC 2616 section 14.2{5,6}).\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.isCachable = function isCachable () {\r\n  var statusCode = this.res.statusCode\r\n  return (statusCode >= 200 && statusCode < 300) ||\r\n    statusCode === 304\r\n}\r\n\r\n/**\r\n * Handle stat() error.\r\n *\r\n * @param {Error} error\r\n * @private\r\n */\r\n\r\nSendStream.prototype.onStatError = function onStatError (error) {\r\n  switch (error.code) {\r\n    case 'ENAMETOOLONG':\r\n    case 'ENOENT':\r\n    case 'ENOTDIR':\r\n      this.error(404, error)\r\n      break\r\n    default:\r\n      this.error(500, error)\r\n      break\r\n  }\r\n}\r\n\r\n/**\r\n * Check if the cache is fresh.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.isFresh = function isFresh () {\r\n  return fresh(this.req.headers, {\r\n    etag: this.res.getHeader('ETag'),\r\n    'last-modified': this.res.getHeader('Last-Modified')\r\n  })\r\n}\r\n\r\n/**\r\n * Check if the range is fresh.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.isRangeFresh = function isRangeFresh () {\r\n  var ifRange = this.req.headers['if-range']\r\n\r\n  if (!ifRange) {\r\n    return true\r\n  }\r\n\r\n  // if-range as etag\r\n  if (ifRange.indexOf('\"') !== -1) {\r\n    var etag = this.res.getHeader('ETag')\r\n    return Boolean(etag && ifRange.indexOf(etag) !== -1)\r\n  }\r\n\r\n  // if-range as modified date\r\n  var lastModified = this.res.getHeader('Last-Modified')\r\n  return parseHttpDate(lastModified) <= parseHttpDate(ifRange)\r\n}\r\n\r\n/**\r\n * Redirect to path.\r\n *\r\n * @param {string} path\r\n * @private\r\n */\r\n\r\nSendStream.prototype.redirect = function redirect (path) {\r\n  var res = this.res\r\n\r\n  if (hasListeners(this, 'directory')) {\r\n    this.emit('directory', res, path)\r\n    return\r\n  }\r\n\r\n  if (this.hasTrailingSlash()) {\r\n    this.error(403)\r\n    return\r\n  }\r\n\r\n  var loc = encodeUrl(collapseLeadingSlashes(this.path + '/'))\r\n  var doc = createHtmlDocument('Redirecting', 'Redirecting to <a href=\"' + escapeHtml(loc) + '\">' +\r\n    escapeHtml(loc) + '</a>')\r\n\r\n  // redirect\r\n  res.statusCode = 301\r\n  res.setHeader('Content-Type', 'text/html; charset=UTF-8')\r\n  res.setHeader('Content-Length', Buffer.byteLength(doc))\r\n  res.setHeader('Content-Security-Policy', \"default-src 'none'\")\r\n  res.setHeader('X-Content-Type-Options', 'nosniff')\r\n  res.setHeader('Location', loc)\r\n  res.end(doc)\r\n}\r\n\r\n/**\r\n * Pipe to `res.\r\n *\r\n * @param {Stream} res\r\n * @return {Stream} res\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.pipe = function pipe (res) {\r\n  // root path\r\n  var root = this._root\r\n\r\n  // references\r\n  this.res = res\r\n\r\n  // decode the path\r\n  var path = decode(this.path)\r\n  if (path === -1) {\r\n    this.error(400)\r\n    return res\r\n  }\r\n\r\n  // null byte(s)\r\n  if (~path.indexOf('\\0')) {\r\n    this.error(400)\r\n    return res\r\n  }\r\n\r\n  var parts\r\n  if (root !== null) {\r\n    // normalize\r\n    if (path) {\r\n      path = normalize('.' + sep + path)\r\n    }\r\n\r\n    // malicious path\r\n    if (UP_PATH_REGEXP.test(path)) {\r\n      debug('malicious path \"%s\"', path)\r\n      this.error(403)\r\n      return res\r\n    }\r\n\r\n    // explode path parts\r\n    parts = path.split(sep)\r\n\r\n    // join / normalize from optional root dir\r\n    path = normalize(join(root, path))\r\n  } else {\r\n    // \"..\" is malicious without \"root\"\r\n    if (UP_PATH_REGEXP.test(path)) {\r\n      debug('malicious path \"%s\"', path)\r\n      this.error(403)\r\n      return res\r\n    }\r\n\r\n    // explode path parts\r\n    parts = normalize(path).split(sep)\r\n\r\n    // resolve the path\r\n    path = resolve(path)\r\n  }\r\n\r\n  // dotfile handling\r\n  if (containsDotFile(parts)) {\r\n    var access = this._dotfiles\r\n\r\n    // legacy support\r\n    if (access === undefined) {\r\n      access = parts[parts.length - 1][0] === '.'\r\n        ? (this._hidden ? 'allow' : 'ignore')\r\n        : 'allow'\r\n    }\r\n\r\n    debug('%s dotfile \"%s\"', access, path)\r\n    switch (access) {\r\n      case 'allow':\r\n        break\r\n      case 'deny':\r\n        this.error(403)\r\n        return res\r\n      case 'ignore':\r\n      default:\r\n        this.error(404)\r\n        return res\r\n    }\r\n  }\r\n\r\n  // index file support\r\n  if (this._index.length && this.hasTrailingSlash()) {\r\n    this.sendIndex(path)\r\n    return res\r\n  }\r\n\r\n  this.sendFile(path)\r\n  return res\r\n}\r\n\r\n/**\r\n * Transfer `path`.\r\n *\r\n * @param {String} path\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.send = function send (path, stat) {\r\n  var len = stat.size\r\n  var options = this.options\r\n  var opts = {}\r\n  var res = this.res\r\n  var req = this.req\r\n  var ranges = req.headers.range\r\n  var offset = options.start || 0\r\n\r\n  if (headersSent(res)) {\r\n    // impossible to send now\r\n    this.headersAlreadySent()\r\n    return\r\n  }\r\n\r\n  debug('pipe \"%s\"', path)\r\n\r\n  // set header fields\r\n  this.setHeader(path, stat)\r\n\r\n  // set content-type\r\n  this.type(path)\r\n\r\n  // conditional GET support\r\n  if (this.isConditionalGET()) {\r\n    if (this.isPreconditionFailure()) {\r\n      this.error(412)\r\n      return\r\n    }\r\n\r\n    if (this.isCachable() && this.isFresh()) {\r\n      this.notModified()\r\n      return\r\n    }\r\n  }\r\n\r\n  // adjust len to start/end options\r\n  len = Math.max(0, len - offset)\r\n  if (options.end !== undefined) {\r\n    var bytes = options.end - offset + 1\r\n    if (len > bytes) len = bytes\r\n  }\r\n\r\n  // Range support\r\n  if (this._acceptRanges && BYTES_RANGE_REGEXP.test(ranges)) {\r\n    // parse\r\n    ranges = parseRange(len, ranges, {\r\n      combine: true\r\n    })\r\n\r\n    // If-Range support\r\n    if (!this.isRangeFresh()) {\r\n      debug('range stale')\r\n      ranges = -2\r\n    }\r\n\r\n    // unsatisfiable\r\n    if (ranges === -1) {\r\n      debug('range unsatisfiable')\r\n\r\n      // Content-Range\r\n      res.setHeader('Content-Range', contentRange('bytes', len))\r\n\r\n      // 416 Requested Range Not Satisfiable\r\n      return this.error(416, {\r\n        headers: { 'Content-Range': res.getHeader('Content-Range') }\r\n      })\r\n    }\r\n\r\n    // valid (syntactically invalid/multiple ranges are treated as a regular response)\r\n    if (ranges !== -2 && ranges.length === 1) {\r\n      debug('range %j', ranges)\r\n\r\n      // Content-Range\r\n      res.statusCode = 206\r\n      res.setHeader('Content-Range', contentRange('bytes', len, ranges[0]))\r\n\r\n      // adjust for requested range\r\n      offset += ranges[0].start\r\n      len = ranges[0].end - ranges[0].start + 1\r\n    }\r\n  }\r\n\r\n  // clone options\r\n  for (var prop in options) {\r\n    opts[prop] = options[prop]\r\n  }\r\n\r\n  // set read options\r\n  opts.start = offset\r\n  opts.end = Math.max(offset, offset + len - 1)\r\n\r\n  // content-length\r\n  res.setHeader('Content-Length', len)\r\n\r\n  // HEAD support\r\n  if (req.method === 'HEAD') {\r\n    res.end()\r\n    return\r\n  }\r\n\r\n  this.stream(path, opts)\r\n}\r\n\r\n/**\r\n * Transfer file for `path`.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\r\nSendStream.prototype.sendFile = function sendFile (path) {\r\n  var i = 0\r\n  var self = this\r\n\r\n  debug('stat \"%s\"', path)\r\n  fs.stat(path, function onstat (err, stat) {\r\n    if (err && err.code === 'ENOENT' && !extname(path) && path[path.length - 1] !== sep) {\r\n      // not found, check extensions\r\n      return next(err)\r\n    }\r\n    if (err) return self.onStatError(err)\r\n    if (stat.isDirectory()) return self.redirect(path)\r\n    self.emit('file', path, stat)\r\n    self.send(path, stat)\r\n  })\r\n\r\n  function next (err) {\r\n    if (self._extensions.length <= i) {\r\n      return err\r\n        ? self.onStatError(err)\r\n        : self.error(404)\r\n    }\r\n\r\n    var p = path + '.' + self._extensions[i++]\r\n\r\n    debug('stat \"%s\"', p)\r\n    fs.stat(p, function (err, stat) {\r\n      if (err) return next(err)\r\n      if (stat.isDirectory()) return next()\r\n      self.emit('file', p, stat)\r\n      self.send(p, stat)\r\n    })\r\n  }\r\n}\r\n\r\n/**\r\n * Transfer index for `path`.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\r\nSendStream.prototype.sendIndex = function sendIndex (path) {\r\n  var i = -1\r\n  var self = this\r\n\r\n  function next (err) {\r\n    if (++i >= self._index.length) {\r\n      if (err) return self.onStatError(err)\r\n      return self.error(404)\r\n    }\r\n\r\n    var p = join(path, self._index[i])\r\n\r\n    debug('stat \"%s\"', p)\r\n    fs.stat(p, function (err, stat) {\r\n      if (err) return next(err)\r\n      if (stat.isDirectory()) return next()\r\n      self.emit('file', p, stat)\r\n      self.send(p, stat)\r\n    })\r\n  }\r\n\r\n  next()\r\n}\r\n\r\n/**\r\n * Stream `path` to the response.\r\n *\r\n * @param {String} path\r\n * @param {Object} options\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.stream = function stream (path, options) {\r\n  var self = this\r\n  var res = this.res\r\n\r\n  // pipe\r\n  var stream = fs.createReadStream(path, options)\r\n  this.emit('stream', stream)\r\n  stream.pipe(res)\r\n\r\n  // cleanup\r\n  function cleanup () {\r\n    destroy(stream, true)\r\n  }\r\n\r\n  // response finished, cleanup\r\n  onFinished(res, cleanup)\r\n\r\n  // error handling\r\n  stream.on('error', function onerror (err) {\r\n    // clean up stream early\r\n    cleanup()\r\n\r\n    // error\r\n    self.onStatError(err)\r\n  })\r\n\r\n  // end\r\n  stream.on('end', function onend () {\r\n    self.emit('end')\r\n  })\r\n}\r\n\r\n/**\r\n * Set content-type based on `path`\r\n * if it hasn't been explicitly set.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.type = function type (path) {\r\n  var res = this.res\r\n\r\n  if (res.getHeader('Content-Type')) return\r\n\r\n  var type = mime.lookup(path)\r\n\r\n  if (!type) {\r\n    debug('no content-type')\r\n    return\r\n  }\r\n\r\n  var charset = mime.charsets.lookup(type)\r\n\r\n  debug('content-type %s', type)\r\n  res.setHeader('Content-Type', type + (charset ? '; charset=' + charset : ''))\r\n}\r\n\r\n/**\r\n * Set response header fields, most\r\n * fields may be pre-defined.\r\n *\r\n * @param {String} path\r\n * @param {Object} stat\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.setHeader = function setHeader (path, stat) {\r\n  var res = this.res\r\n\r\n  this.emit('headers', res, path, stat)\r\n\r\n  if (this._acceptRanges && !res.getHeader('Accept-Ranges')) {\r\n    debug('accept ranges')\r\n    res.setHeader('Accept-Ranges', 'bytes')\r\n  }\r\n\r\n  if (this._cacheControl && !res.getHeader('Cache-Control')) {\r\n    var cacheControl = 'public, max-age=' + Math.floor(this._maxage / 1000)\r\n\r\n    if (this._immutable) {\r\n      cacheControl += ', immutable'\r\n    }\r\n\r\n    debug('cache-control %s', cacheControl)\r\n    res.setHeader('Cache-Control', cacheControl)\r\n  }\r\n\r\n  if (this._lastModified && !res.getHeader('Last-Modified')) {\r\n    var modified = stat.mtime.toUTCString()\r\n    debug('modified %s', modified)\r\n    res.setHeader('Last-Modified', modified)\r\n  }\r\n\r\n  if (this._etag && !res.getHeader('ETag')) {\r\n    var val = etag(stat)\r\n    debug('etag %s', val)\r\n    res.setHeader('ETag', val)\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all headers from a response.\r\n *\r\n * @param {object} res\r\n * @private\r\n */\r\n\r\nfunction clearHeaders (res) {\r\n  var headers = getHeaderNames(res)\r\n\r\n  for (var i = 0; i < headers.length; i++) {\r\n    res.removeHeader(headers[i])\r\n  }\r\n}\r\n\r\n/**\r\n * Collapse all leading slashes into a single slash\r\n *\r\n * @param {string} str\r\n * @private\r\n */\r\nfunction collapseLeadingSlashes (str) {\r\n  for (var i = 0; i < str.length; i++) {\r\n    if (str[i] !== '/') {\r\n      break\r\n    }\r\n  }\r\n\r\n  return i > 1\r\n    ? '/' + str.substr(i)\r\n    : str\r\n}\r\n\r\n/**\r\n * Determine if path parts contain a dotfile.\r\n *\r\n * @api private\r\n */\r\n\r\nfunction containsDotFile (parts) {\r\n  for (var i = 0; i < parts.length; i++) {\r\n    var part = parts[i]\r\n    if (part.length > 1 && part[0] === '.') {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return false\r\n}\r\n\r\n/**\r\n * Create a Content-Range header.\r\n *\r\n * @param {string} type\r\n * @param {number} size\r\n * @param {array} [range]\r\n */\r\n\r\nfunction contentRange (type, size, range) {\r\n  return type + ' ' + (range ? range.start + '-' + range.end : '*') + '/' + size\r\n}\r\n\r\n/**\r\n * Create a minimal HTML document.\r\n *\r\n * @param {string} title\r\n * @param {string} body\r\n * @private\r\n */\r\n\r\nfunction createHtmlDocument (title, body) {\r\n  return '<!DOCTYPE html>\\n' +\r\n    '<html lang=\"en\">\\n' +\r\n    '<head>\\n' +\r\n    '<meta charset=\"utf-8\">\\n' +\r\n    '<title>' + title + '</title>\\n' +\r\n    '</head>\\n' +\r\n    '<body>\\n' +\r\n    '<pre>' + body + '</pre>\\n' +\r\n    '</body>\\n' +\r\n    '</html>\\n'\r\n}\r\n\r\n/**\r\n * Create a HttpError object from simple arguments.\r\n *\r\n * @param {number} status\r\n * @param {Error|object} err\r\n * @private\r\n */\r\n\r\nfunction createHttpError (status, err) {\r\n  if (!err) {\r\n    return createError(status)\r\n  }\r\n\r\n  return err instanceof Error\r\n    ? createError(status, err, { expose: false })\r\n    : createError(status, err)\r\n}\r\n\r\n/**\r\n * decodeURIComponent.\r\n *\r\n * Allows V8 to only deoptimize this fn instead of all\r\n * of send().\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\r\n\r\nfunction decode (path) {\r\n  try {\r\n    return decodeURIComponent(path)\r\n  } catch (err) {\r\n    return -1\r\n  }\r\n}\r\n\r\n/**\r\n * Get the header names on a respnse.\r\n *\r\n * @param {object} res\r\n * @returns {array[string]}\r\n * @private\r\n */\r\n\r\nfunction getHeaderNames (res) {\r\n  return typeof res.getHeaderNames !== 'function'\r\n    ? Object.keys(res._headers || {})\r\n    : res.getHeaderNames()\r\n}\r\n\r\n/**\r\n * Determine if emitter has listeners of a given type.\r\n *\r\n * The way to do this check is done three different ways in Node.js >= 0.8\r\n * so this consolidates them into a minimal set using instance methods.\r\n *\r\n * @param {EventEmitter} emitter\r\n * @param {string} type\r\n * @returns {boolean}\r\n * @private\r\n */\r\n\r\nfunction hasListeners (emitter, type) {\r\n  var count = typeof emitter.listenerCount !== 'function'\r\n    ? emitter.listeners(type).length\r\n    : emitter.listenerCount(type)\r\n\r\n  return count > 0\r\n}\r\n\r\n/**\r\n * Determine if the response headers have been sent.\r\n *\r\n * @param {object} res\r\n * @returns {boolean}\r\n * @private\r\n */\r\n\r\nfunction headersSent (res) {\r\n  return typeof res.headersSent !== 'boolean'\r\n    ? Boolean(res._header)\r\n    : res.headersSent\r\n}\r\n\r\n/**\r\n * Normalize the index option into an array.\r\n *\r\n * @param {boolean|string|array} val\r\n * @param {string} name\r\n * @private\r\n */\r\n\r\nfunction normalizeList (val, name) {\r\n  var list = [].concat(val || [])\r\n\r\n  for (var i = 0; i < list.length; i++) {\r\n    if (typeof list[i] !== 'string') {\r\n      throw new TypeError(name + ' must be array of strings or false')\r\n    }\r\n  }\r\n\r\n  return list\r\n}\r\n\r\n/**\r\n * Parse an HTTP Date into a number.\r\n *\r\n * @param {string} date\r\n * @private\r\n */\r\n\r\nfunction parseHttpDate (date) {\r\n  var timestamp = date && Date.parse(date)\r\n\r\n  return typeof timestamp === 'number'\r\n    ? timestamp\r\n    : NaN\r\n}\r\n\r\n/**\r\n * Parse a HTTP token list.\r\n *\r\n * @param {string} str\r\n * @private\r\n */\r\n\r\nfunction parseTokenList (str) {\r\n  var end = 0\r\n  var list = []\r\n  var start = 0\r\n\r\n  // gather tokens\r\n  for (var i = 0, len = str.length; i < len; i++) {\r\n    switch (str.charCodeAt(i)) {\r\n      case 0x20: /*   */\r\n        if (start === end) {\r\n          start = end = i + 1\r\n        }\r\n        break\r\n      case 0x2c: /* , */\r\n        if (start !== end) {\r\n          list.push(str.substring(start, end))\r\n        }\r\n        start = end = i + 1\r\n        break\r\n      default:\r\n        end = i + 1\r\n        break\r\n    }\r\n  }\r\n\r\n  // final token\r\n  if (start !== end) {\r\n    list.push(str.substring(start, end))\r\n  }\r\n\r\n  return list\r\n}\r\n\r\n/**\r\n * Set an object of headers on a response.\r\n *\r\n * @param {object} res\r\n * @param {object} headers\r\n * @private\r\n */\r\n\r\nfunction setHeaders (res, headers) {\r\n  var keys = Object.keys(headers)\r\n\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i]\r\n    res.setHeader(key, headers[key])\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}