{"ast":null,"code":"// Copyright 2012 Iris Couch, all rights reserved.\n//\n// Test displaying DNS records\nvar util = require('util');\n\nvar parse = require('./parse');\n\nvar encode = require('./encode');\n\nvar constants = require('./constants');\n\nmodule.exports = DNSMessage;\nvar SECTIONS = ['question', 'answer', 'authority', 'additional']; // A DNS message.  This is an easy-to-understand object representation of\n// standard DNS queries and responses.\n//\n// Attributes:\n// * id                  - a number representing the unique query ID\n// * type                - \"request\" or \"response\"\n// * response            - Number (server response code)\n// * opcode              - \"query\", \"iquery\", \"status\", \"unassigned\", \"notify\", \"update\"\n// * authoritative       - Boolean\n// * truncated           - Boolean\n// * recursion_desired   - Boolean\n// * recursion_available - Boolean\n// * authenticated       - Boolean\n// * checking_disabled   - Boolean\n//\n// Optional attributes:\n// * question (optional) - Array of the question section\n// * answer (optional) - Array of the answer section\n// * authority (optional) - Array of the authority section\n// * additional (optional) - Array of the additional section\n//\n// Methods:\n// * toString() - return a human-readable representation of this message\n// * toJSON() - Return a JSON-friendly represenation of this message\n// * toBinary() - Return a buffer of the encoded message\n\nfunction DNSMessage(body) {\n  var self = this;\n  this.id = null;\n  this.type = null;\n  this.responseCode = null;\n  this.opcode = null;\n  this.authoritative = null;\n  this.truncated = null;\n  this.recursion_desired = null;\n  this.recursion_available = null;\n  this.authenticated = null;\n  this.checking_disabled = null;\n  if (Buffer.isBuffer(body)) this.parse(body);else if (typeof body != 'object') throw new Error('Must provide a buffer or object argument with message contents');else {\n    Object.keys(body).forEach(function (key) {\n      self[key] = body[key];\n    });\n    SECTIONS.forEach(function (section) {\n      if (self[section]) self[section].forEach(function (record, i) {\n        self[section][i] = new DNSRecord(record);\n      });\n    });\n  } // EDNS processing. For now, just remove those records.\n\n  SECTIONS.forEach(function (section) {\n    if (self[section]) {\n      self[section] = self[section].filter(function (record) {\n        return !record.edns;\n      });\n      if (self[section].length == 0) delete self[section];\n    }\n  });\n}\n\nDNSMessage.prototype.parse = function (body) {\n  var self = this;\n  self.id = parse.id(body);\n  var qr = parse.qr(body);\n  self.type = qr == 0 ? 'request' : 'response';\n  self.responseCode = parse.rcode(body);\n  var opcode_names = ['query', 'iquery', 'status', null, 'notify', 'update'];\n  var opcode = parse.opcode(body);\n  self.opcode = opcode_names[opcode] || null;\n  self.authoritative = !!parse.aa(body);\n  self.truncated = !!parse.tc(body);\n  self.recursion_desired = !!parse.rd(body);\n  self.recursion_available = !!parse.ra(body);\n  self.authenticated = !!parse.ad(body);\n  self.checking_disabled = !!parse.cd(body);\n  var sections_cache = parse.sections(body);\n  SECTIONS.forEach(function (section) {\n    var count = parse.record_count(body, section);\n\n    if (count) {\n      self[section] = [];\n\n      for (var i = 0; i < count; i++) self[section].push(new DNSRecord(body, section, i, sections_cache));\n    }\n  });\n};\n\nDNSMessage.prototype.toBinary = function () {\n  // The encoder is picky, so make sure it gets a valid message.\n  var msg = JSON.parse(JSON.stringify(this));\n  SECTIONS.forEach(function (section) {\n    if (section == 'question') return;\n    msg[section] = msg[section] || [];\n    msg[section].forEach(function (record) {\n      if (record.class != 'IN') return; // Make sure records promising data have data.\n\n      if (record.class == 'IN' && record.type == 'A') record.data = record.data || '0.0.0.0'; // Convert SOA email addresses back to the dotted notation.\n\n      if (record.class == 'IN' && record.type == 'SOA') record.data.rname = record.data.rname.replace(/@/g, '.'); // Normalize TXT records.\n\n      if (record.type == 'TXT' && typeof record.data == 'string') record.data = [record.data];\n    });\n  });\n  var state = new encode.State();\n  state.message(msg);\n  return state.toBinary();\n};\n\nDNSMessage.prototype.toString = function () {\n  var self = this;\n  var info = [util.format('ID                 : %d', self.id), util.format(\"Type               : %s\", self.type), util.format(\"Opcode             : %s\", self.opcode), util.format(\"Authoritative      : %s\", self.authoritative), util.format(\"Truncated          : %s\", self.truncated), util.format(\"Recursion Desired  : %s\", self.recursion_desired), util.format(\"Recursion Available: %s\", self.recursion_available), util.format(\"Response Code      : %d\", self.responseCode)];\n  SECTIONS.forEach(function (section) {\n    if (self[section]) {\n      info.push(util.format(';; %s SECTION:', section.toUpperCase()));\n      self[section].forEach(function (record) {\n        info.push(record.toString());\n      });\n    }\n  });\n  return info.join('\\n');\n}; // An individual record from a DNS message\n//\n// Attributes:\n// * name  - Host name\n// * type  - Query type ('A', 'NS', 'CNAME', etc. or 'Unknown')\n// * class - Network class ('IN', 'None' 'Unknown')\n// * ttl   - Time to live for the data in the record\n// * data  - The record data value, or null if not applicable\n\n\nfunction DNSRecord(body, section_name, record_num, sections_cache) {\n  var self = this;\n  this.name = null;\n  this.type = null;\n  this.class = null; // Leave these undefined for more consice and clear JSON serialization.\n  //this.ttl  = null\n  //this.data = null\n\n  if (Buffer.isBuffer(body)) this.parse(body, section_name, record_num, sections_cache || body);else if (typeof body != 'object') throw new Error('Must provide a buffer or object argument with message contents');else Object.keys(body).forEach(function (key) {\n    self[key] = body[key];\n  });\n}\n\nDNSRecord.prototype.parse = function (body, section_name, record_num, sections) {\n  var self = this;\n  self.name = parse.record_name(sections, section_name, record_num);\n  var type = parse.record_type(sections, section_name, record_num);\n  self.type = constants.type_to_label(type);\n  if (!self.type) throw new Error('Record ' + record_num + ' in section \"' + section_name + '\" has unknown type: ' + type);\n\n  if (section_name != 'additional' || self.type != 'OPT' || self.name != '') {\n    // Normal record\n    var clas = parse.record_class(sections, section_name, record_num);\n    self.class = constants.class_to_label(clas);\n    if (!self.class) throw new Error('Record ' + record_num + ' in section \"' + section_name + '\" has unknown class: ' + type);\n    if (section_name == 'question') return;else self.ttl = parse.record_ttl(sections, section_name, record_num);\n  } else {\n    // EDNS record\n    self.edns = true;\n    delete self.name;\n    delete self.class; //self.edns = parse.record_edns(sections, section_name, record_num)\n  }\n\n  var rdata = parse.record_data(sections, section_name, record_num);\n\n  switch (self.kind()) {\n    case 'IN A':\n      if (rdata.length != 4) throw new Error('Bad IN A data: ' + JSON.stringify(self));\n      self.data = inet_ntoa(rdata);\n      break;\n\n    case 'IN AAAA':\n      if (rdata.length != 16) throw new Error('Bad IN AAAA data: ' + JSON.stringify(self));\n      self.data = inet_ntoa6(rdata);\n      break;\n\n    case 'IN NS':\n    case 'IN CNAME':\n    case 'IN PTR':\n      self.data = parse.uncompress(body, rdata);\n      break;\n\n    case 'IN TXT':\n      self.data = parse.txt(body, rdata);\n      if (self.data.length === 0) self.data = '';else if (self.data.length === 1) self.data = self.data[0];\n      break;\n\n    case 'IN MX':\n      self.data = parse.mx(body, rdata);\n      break;\n\n    case 'IN SRV':\n      self.data = parse.srv(body, rdata);\n      break;\n\n    case 'IN SOA':\n      self.data = parse.soa(body, rdata);\n      self.data.rname = self.data.rname.replace(/\\./, '@');\n      break;\n\n    case 'IN DS':\n      self.data = {\n        'key_tag': rdata[0] << 8 | rdata[1],\n        'algorithm': rdata[2],\n        'digest_type': rdata[3],\n        'digest': rdata.slice(4).toJSON() // Convert to a list of numbers.\n\n      };\n      break;\n\n    case 'NONE A':\n      self.data = [];\n      break;\n\n    case 'EDNS':\n      self.data = rdata;\n      break;\n\n    default:\n      throw new Error('Unknown record ' + self.kind() + ': ' + JSON.stringify(self));\n  }\n};\n\nDNSRecord.prototype.kind = function () {\n  return this.edns ? 'EDNS' : this.class + ' ' + this.type;\n};\n\nDNSRecord.prototype.toString = function () {\n  var self = this;\n  return [width(23, self.name), width(7, self.ttl || ''), width(7, self.class), width(7, self.type), self.type == 'MX' && self.data ? width(3, self.data[0]) + ' ' + self.data[1] : Buffer.isBuffer(self.data) ? self.data.toString('hex') : self.data || ''].join(' ');\n}; //\n// Utilities\n//\n\n\nfunction width(str_len, str) {\n  str = '' + str;\n\n  do {\n    var needed = str_len - str.length;\n    if (needed > 0) str = ' ' + str;\n  } while (needed > 0);\n\n  return str;\n}\n\nfunction inet_ntoa(buf) {\n  return buf[0] + '.' + buf[1] + '.' + buf[2] + '.' + buf[3];\n}\n\nfunction inet_ntoa6(buf) {\n  var result = [];\n\n  for (var i = 0; i < 16; i += 2) result.push(buf.slice(i, i + 2).toString('hex'));\n\n  return result.join(':');\n}","map":{"version":3,"names":["util","require","parse","encode","constants","module","exports","DNSMessage","SECTIONS","body","self","id","type","responseCode","opcode","authoritative","truncated","recursion_desired","recursion_available","authenticated","checking_disabled","Buffer","isBuffer","Error","Object","keys","forEach","key","section","record","i","DNSRecord","filter","edns","length","prototype","qr","rcode","opcode_names","aa","tc","rd","ra","ad","cd","sections_cache","sections","count","record_count","push","toBinary","msg","JSON","stringify","class","data","rname","replace","state","State","message","toString","info","format","toUpperCase","join","section_name","record_num","name","record_name","record_type","type_to_label","clas","record_class","class_to_label","ttl","record_ttl","rdata","record_data","kind","inet_ntoa","inet_ntoa6","uncompress","txt","mx","srv","soa","slice","toJSON","width","str_len","str","needed","buf","result"],"sources":["C:/Users/Kamen/ML/AlgoTrader/node_modules/hbo-dnsd/message.js"],"sourcesContent":["// Copyright 2012 Iris Couch, all rights reserved.\r\n//\r\n// Test displaying DNS records\r\n\r\nvar util = require('util')\r\n\r\nvar parse = require('./parse')\r\nvar encode = require('./encode')\r\nvar constants = require('./constants')\r\n\r\nmodule.exports = DNSMessage\r\n\r\nvar SECTIONS = ['question', 'answer', 'authority', 'additional']\r\n\r\n// A DNS message.  This is an easy-to-understand object representation of\r\n// standard DNS queries and responses.\r\n//\r\n// Attributes:\r\n// * id                  - a number representing the unique query ID\r\n// * type                - \"request\" or \"response\"\r\n// * response            - Number (server response code)\r\n// * opcode              - \"query\", \"iquery\", \"status\", \"unassigned\", \"notify\", \"update\"\r\n// * authoritative       - Boolean\r\n// * truncated           - Boolean\r\n// * recursion_desired   - Boolean\r\n// * recursion_available - Boolean\r\n// * authenticated       - Boolean\r\n// * checking_disabled   - Boolean\r\n//\r\n// Optional attributes:\r\n// * question (optional) - Array of the question section\r\n// * answer (optional) - Array of the answer section\r\n// * authority (optional) - Array of the authority section\r\n// * additional (optional) - Array of the additional section\r\n//\r\n// Methods:\r\n// * toString() - return a human-readable representation of this message\r\n// * toJSON() - Return a JSON-friendly represenation of this message\r\n// * toBinary() - Return a buffer of the encoded message\r\nfunction DNSMessage (body) {\r\n  var self = this\r\n\r\n  this.id = null\r\n  this.type                = null\r\n  this.responseCode        = null\r\n  this.opcode              = null\r\n  this.authoritative       = null\r\n  this.truncated           = null\r\n  this.recursion_desired   = null\r\n  this.recursion_available = null\r\n  this.authenticated       = null\r\n  this.checking_disabled   = null\r\n\r\n  if(Buffer.isBuffer(body))\r\n    this.parse(body)\r\n  else if(typeof body != 'object')\r\n    throw new Error('Must provide a buffer or object argument with message contents')\r\n  else {\r\n    Object.keys(body).forEach(function(key) { self[key] = body[key] })\r\n    SECTIONS.forEach(function(section) {\r\n      if(self[section])\r\n        self[section].forEach(function(record, i) {\r\n          self[section][i] = new DNSRecord(record)\r\n        })\r\n    })\r\n  }\r\n\r\n  // EDNS processing. For now, just remove those records.\r\n  SECTIONS.forEach(function(section) {\r\n    if(self[section]) {\r\n      self[section] = self[section].filter(function(record) { return ! record.edns })\r\n      if(self[section].length == 0)\r\n        delete self[section]\r\n    }\r\n  })\r\n}\r\n\r\nDNSMessage.prototype.parse = function(body) {\r\n  var self = this\r\n\r\n  self.id = parse.id(body)\r\n\r\n  var qr = parse.qr(body)\r\n  self.type = (qr == 0) ? 'request' : 'response'\r\n\r\n  self.responseCode = parse.rcode(body)\r\n\r\n  var opcode_names = ['query', 'iquery', 'status', null, 'notify', 'update']\r\n  var opcode = parse.opcode(body)\r\n  self.opcode = opcode_names[opcode] || null\r\n\r\n  self.authoritative       = !! parse.aa(body)\r\n  self.truncated           = !! parse.tc(body)\r\n  self.recursion_desired   = !! parse.rd(body)\r\n  self.recursion_available = !! parse.ra(body)\r\n  self.authenticated       = !! parse.ad(body)\r\n  self.checking_disabled   = !! parse.cd(body)\r\n\r\n  var sections_cache = parse.sections(body)\r\n\r\n  SECTIONS.forEach(function(section) {\r\n    var count = parse.record_count(body, section)\r\n    if(count) {\r\n      self[section] = []\r\n      for(var i = 0; i < count; i++)\r\n        self[section].push(new DNSRecord(body, section, i, sections_cache))\r\n    }\r\n  })\r\n}\r\n\r\nDNSMessage.prototype.toBinary = function() {\r\n  // The encoder is picky, so make sure it gets a valid message.\r\n  var msg = JSON.parse(JSON.stringify(this))\r\n\r\n  SECTIONS.forEach(function(section) {\r\n    if(section == 'question')\r\n      return\r\n\r\n    msg[section] = msg[section] || []\r\n    msg[section].forEach(function(record) {\r\n      if(record.class != 'IN')\r\n        return\r\n\r\n      // Make sure records promising data have data.\r\n      if(record.class == 'IN' && record.type == 'A')\r\n        record.data = record.data || '0.0.0.0'\r\n\r\n      // Convert SOA email addresses back to the dotted notation.\r\n      if(record.class == 'IN' && record.type == 'SOA')\r\n        record.data.rname = record.data.rname.replace(/@/g, '.')\r\n\r\n      // Normalize TXT records.\r\n      if(record.type == 'TXT' && typeof record.data == 'string')\r\n        record.data = [record.data]\r\n    })\r\n  })\r\n\r\n  var state = new encode.State\r\n  state.message(msg)\r\n  return state.toBinary()\r\n}\r\n\r\nDNSMessage.prototype.toString = function() {\r\n  var self = this\r\n\r\n  var info = [ util.format('ID                 : %d', self.id)\r\n             , util.format(\"Type               : %s\", self.type)\r\n             , util.format(\"Opcode             : %s\", self.opcode)\r\n             , util.format(\"Authoritative      : %s\", self.authoritative)\r\n             , util.format(\"Truncated          : %s\", self.truncated)\r\n             , util.format(\"Recursion Desired  : %s\", self.recursion_desired)\r\n             , util.format(\"Recursion Available: %s\", self.recursion_available)\r\n             , util.format(\"Response Code      : %d\", self.responseCode)\r\n             ]\r\n\r\n  SECTIONS.forEach(function(section) {\r\n    if(self[section]) {\r\n      info.push(util.format(';; %s SECTION:', section.toUpperCase()))\r\n      self[section].forEach(function(record) {\r\n        info.push(record.toString())\r\n      })\r\n    }\r\n  })\r\n\r\n  return info.join('\\n')\r\n}\r\n\r\n\r\n// An individual record from a DNS message\r\n//\r\n// Attributes:\r\n// * name  - Host name\r\n// * type  - Query type ('A', 'NS', 'CNAME', etc. or 'Unknown')\r\n// * class - Network class ('IN', 'None' 'Unknown')\r\n// * ttl   - Time to live for the data in the record\r\n// * data  - The record data value, or null if not applicable\r\nfunction DNSRecord (body, section_name, record_num, sections_cache) {\r\n  var self = this\r\n\r\n  this.name = null\r\n  this.type = null\r\n  this.class = null\r\n\r\n  // Leave these undefined for more consice and clear JSON serialization.\r\n  //this.ttl  = null\r\n  //this.data = null\r\n\r\n  if(Buffer.isBuffer(body))\r\n    this.parse(body, section_name, record_num, sections_cache || body)\r\n  else if(typeof body != 'object')\r\n    throw new Error('Must provide a buffer or object argument with message contents')\r\n  else\r\n    Object.keys(body).forEach(function(key) { self[key] = body[key] })\r\n}\r\n\r\nDNSRecord.prototype.parse = function(body, section_name, record_num, sections) {\r\n  var self = this\r\n\r\n  self.name = parse.record_name(sections, section_name, record_num)\r\n\r\n  var type = parse.record_type(sections, section_name, record_num)\r\n  self.type = constants.type_to_label(type)\r\n  if(! self.type)\r\n    throw new Error('Record '+record_num+' in section \"'+section_name+'\" has unknown type: ' + type)\r\n\r\n  if(section_name != 'additional' || self.type != 'OPT' || self.name != '') {\r\n    // Normal record\r\n    var clas = parse.record_class(sections, section_name, record_num)\r\n    self.class = constants.class_to_label(clas)\r\n    if(! self.class)\r\n      throw new Error('Record '+record_num+' in section \"'+section_name+'\" has unknown class: ' + type)\r\n\r\n    if(section_name == 'question')\r\n      return\r\n    else\r\n      self.ttl  = parse.record_ttl(sections, section_name, record_num)\r\n  } else {\r\n    // EDNS record\r\n    self.edns = true\r\n    delete self.name\r\n    delete self.class\r\n    //self.edns = parse.record_edns(sections, section_name, record_num)\r\n  }\r\n\r\n  var rdata = parse.record_data(sections, section_name, record_num)\r\n  switch (self.kind()) {\r\n    case 'IN A':\r\n      if(rdata.length != 4)\r\n        throw new Error('Bad IN A data: ' + JSON.stringify(self))\r\n      self.data = inet_ntoa(rdata)\r\n      break\r\n    case 'IN AAAA':\r\n      if(rdata.length != 16)\r\n        throw new Error('Bad IN AAAA data: ' + JSON.stringify(self))\r\n      self.data = inet_ntoa6(rdata)\r\n      break\r\n    case 'IN NS':\r\n    case 'IN CNAME':\r\n    case 'IN PTR':\r\n      self.data = parse.uncompress(body, rdata)\r\n      break\r\n    case 'IN TXT':\r\n      self.data = parse.txt(body, rdata)\r\n      if(self.data.length === 0)\r\n        self.data = ''\r\n      else if(self.data.length === 1)\r\n        self.data = self.data[0]\r\n      break\r\n    case 'IN MX':\r\n      self.data = parse.mx(body, rdata)\r\n      break\r\n    case 'IN SRV':\r\n      self.data = parse.srv(body, rdata)\r\n      break\r\n    case 'IN SOA':\r\n      self.data = parse.soa(body, rdata)\r\n      self.data.rname = self.data.rname.replace(/\\./, '@')\r\n      break\r\n    case 'IN DS':\r\n      self.data = { 'key_tag'    : rdata[0] << 8 | rdata[1]\r\n                  , 'algorithm'  : rdata[2]\r\n                  , 'digest_type': rdata[3]\r\n                  , 'digest'     : rdata.slice(4).toJSON() // Convert to a list of numbers.\r\n                  }\r\n      break\r\n    case 'NONE A':\r\n      self.data = []\r\n      break\r\n    case 'EDNS':\r\n      self.data = rdata\r\n      break\r\n    default:\r\n      throw new Error('Unknown record '+self.kind()+': ' + JSON.stringify(self))\r\n  }\r\n}\r\n\r\nDNSRecord.prototype.kind = function() {\r\n  return this.edns\r\n          ? 'EDNS'\r\n          : this.class + ' ' + this.type\r\n}\r\n\r\nDNSRecord.prototype.toString = function() {\r\n  var self = this\r\n  return [ width(23, self.name)\r\n         , width( 7, self.ttl || '')\r\n         , width( 7, self.class)\r\n         , width( 7, self.type)\r\n         , self.type == 'MX' && self.data\r\n            ? (width(3, self.data[0]) + ' ' + self.data[1])\r\n           : Buffer.isBuffer(self.data)\r\n            ? self.data.toString('hex')\r\n            : self.data || ''\r\n         ].join(' ')\r\n}\r\n\r\n//\r\n// Utilities\r\n//\r\n\r\nfunction width(str_len, str) {\r\n  str = '' + str\r\n  do {\r\n    var needed = str_len - str.length\r\n    if(needed > 0)\r\n      str = ' ' + str\r\n  } while(needed > 0)\r\n\r\n  return str\r\n}\r\n\r\nfunction inet_ntoa(buf) {\r\n  return buf[0] + '.' + buf[1] + '.' + buf[2] + '.' + buf[3]\r\n}\r\n\r\nfunction inet_ntoa6(buf) {\r\n  var result = []\r\n  for(var i = 0; i < 16; i += 2)\r\n    result.push(buf.slice(i, i+2).toString('hex'))\r\n  return result.join(':')\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}